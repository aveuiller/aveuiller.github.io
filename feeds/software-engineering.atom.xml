<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Antoine Veuiller - Software Engineering</title><link href="https://aveuiller.github.io/" rel="alternate"></link><link href="https://aveuiller.github.io/feeds/software-engineering.atom.xml" rel="self"></link><id>https://aveuiller.github.io/</id><updated>2021-01-27T00:00:00+01:00</updated><entry><title>Spring Boot Apprentice Cookbook</title><link href="https://aveuiller.github.io/spring_boot_apprentice_cookbook.html" rel="alternate"></link><published>2021-01-27T00:00:00+01:00</published><updated>2021-01-27T00:00:00+01:00</updated><author><name>Antoine Veuiller</name></author><id>tag:aveuiller.github.io,2021-01-27:/spring_boot_apprentice_cookbook.html</id><summary type="html">&lt;p&gt;Spring Boot cheat sheet from a beginner for beginners&lt;/p&gt;</summary><content type="html">&lt;h3&gt;Availability Disclaimer&lt;/h3&gt;
&lt;p&gt;This article can be found on other sources:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Medium: &lt;a href="https://medium.com/@aveuiller/spring-boot-apprentice-cookbook-61db5a3f6450"&gt;Canonical link&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img alt="Spring Boot logo" src="https://cdn-images-1.medium.com/max/800/1*gxXLMIuJDHCH7fwIgEP1cg.png" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://spring.io/projects/spring-boot"&gt;Spring Boot&lt;/a&gt; is a web framework built on top of the framework &lt;a href="https://spring.io/projects/spring-framework"&gt;Spring&lt;/a&gt;. It is designed for easier use and quicker implementation. It does so by configuring the application and its environment as automatically as possible. As a newcomer, I can say that it makes the framework really easy to get into.&lt;/p&gt;
&lt;p&gt;My learning led me to read most of the &lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#using-boot-structuring-your-code"&gt;reference documentation&lt;/a&gt;, which is well written and gives you a lot of insights into the internal behavior of Spring Boot. This documentation gives a lot of details, so this article aims to take the counter approach and pinpoint the concepts you will need to implement an API using Spring Boot. I will complement each section with a set of links to related documentation, may you want to dig further.&lt;/p&gt;
&lt;p&gt;As a side note, this document will be using version 2.4.2 of the framework, on a Java project using Gradle as the build system. 
However, the information remains applicable to any compatible language and build system.&lt;/p&gt;
&lt;p&gt;This article will cover the following aspects of creating an API with Spring Boot:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Bootstrap the project&lt;/li&gt;
&lt;li&gt;Create REST endpoints&lt;/li&gt;
&lt;li&gt;Handle errors&lt;/li&gt;
&lt;li&gt;Connect to a persistence layer&lt;/li&gt;
&lt;li&gt;Paginate the results&lt;/li&gt;
&lt;li&gt;Test the application&lt;/li&gt;
&lt;li&gt;Package the Application&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Bootstrap the project&lt;/h3&gt;
&lt;p&gt;This part may be the easiest, as Spring Boot is providing a package generator at &lt;a href="https://start.spring.io/"&gt;https://start.spring.io/&lt;/a&gt;. We can select all required modules and retrieve an archived project with the build system, dependencies, and main application class.&lt;/p&gt;
&lt;p&gt;Outside of this generator, to declare a RESTful API, our project should define the Spring Boot &lt;em&gt;starter web&lt;/em&gt; dependency. 
The &lt;em&gt;starter&lt;/em&gt; dependencies are a set of ready to use features packaged by Spring Boot.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;plugins &lt;span style="color: #666666"&gt;{&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;  id &lt;span style="color: #BA2121"&gt;&amp;#39;org.springframework.boot&amp;#39;&lt;/span&gt; version &lt;span style="color: #BA2121"&gt;&amp;#39;2.4.2&amp;#39;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;&lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;4&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;5&lt;/span&gt;dependencies &lt;span style="color: #666666"&gt;{&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;6&lt;/span&gt;  implementation &lt;span style="color: #BA2121"&gt;&amp;#39;org.springframework.boot:spring-boot-starter-web&amp;#39;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;7&lt;/span&gt;&lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The application’s main method should be contained in any class, on which we should apply the annotation &lt;code&gt;@SpringBootApplication&lt;/code&gt;. This annotation is responsible for a lot of automatic configurations, namely the components injection and web server startup.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@SpringBootApplication&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;MyApplication&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;static&lt;/span&gt; &lt;span style="color: #B00040"&gt;void&lt;/span&gt; &lt;span style="color: #0000FF"&gt;main&lt;/span&gt;(String&lt;span style="color: #666666"&gt;[]&lt;/span&gt; args) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;4&lt;/span&gt;        SpringApplication.&lt;span style="color: #7D9029"&gt;run&lt;/span&gt;(MyApplication.&lt;span style="color: #7D9029"&gt;class&lt;/span&gt;, args);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;5&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;6&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Starting the server is as simple as using the embedded command &lt;code&gt;./gradlew bootRun&lt;/code&gt;. 
The server will start, but we don’t have any endpoint to serve at the moment.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Documentation links:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#using-boot-using-springbootapplication-annotation"&gt;@SpringBootApplication&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#using-boot-starter"&gt;List of starter dependencies&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Create a REST endpoint&lt;/h3&gt;
&lt;p&gt;To create a controller, we simply have to annotate any class with &lt;code&gt;@RestController&lt;/code&gt;.
We can then configure any method inside this controller as an endpoint using &lt;code&gt;@RequestMapping&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@RequestMapping&lt;/code&gt; help us configuring the endpoint by providing an URL, the HTTP verb, the expected data type, and more. 
It can be applied both on a class and a method, the configurations applied on the class will be inherited by the methods underneath and the path concatenated.&lt;/p&gt;
&lt;p&gt;To control our endpoint status codes we will return a&lt;code&gt;ResponseEntity&lt;/code&gt;, holding both the response message and &lt;code&gt;HttpStatus&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@RestController&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;/hello&amp;quot;&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;        consumes &lt;span style="color: #666666"&gt;=&lt;/span&gt; MediaType.&lt;span style="color: #7D9029"&gt;ALL_VALUE&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;        produces &lt;span style="color: #666666"&gt;=&lt;/span&gt; MediaType.&lt;span style="color: #7D9029"&gt;APPLICATION_JSON_VALUE&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;HelloWorldController&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;/world&amp;quot;&lt;/span&gt;, method &lt;span style="color: #666666"&gt;=&lt;/span&gt; RequestMethod.&lt;span style="color: #7D9029"&gt;GET&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Map&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style="color: #0000FF"&gt;index&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;        HashMap&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&lt;/span&gt; output &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; HashMap&lt;span style="color: #666666"&gt;&amp;lt;&amp;gt;&lt;/span&gt;();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;        output.&lt;span style="color: #7D9029"&gt;put&lt;/span&gt;(&lt;span style="color: #BA2121"&gt;&amp;quot;message&amp;quot;&lt;/span&gt;, &lt;span style="color: #BA2121"&gt;&amp;quot;Hello World!&amp;quot;&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&amp;gt;&lt;/span&gt;(output, HttpStatus.&lt;span style="color: #7D9029"&gt;OK&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;ResponseEntity&lt;/code&gt; will be automatically transformed to an HTTP response, using the &lt;code&gt;HttpStatus&lt;/code&gt; as response code and transforming the message to a JSON object.
On top of transforming &lt;em&gt;Maps&lt;/em&gt; to JSON objects, Spring Boot configure &lt;a href="https://github.com/FasterXML/jackson"&gt;Jackson&lt;/a&gt; to map all &lt;code&gt;public&lt;/code&gt; attributes or getters of any class to a JSON object.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;$ curl -i &lt;span style="color: #BA2121"&gt;&amp;quot;localhost:8080/hello/world&amp;quot;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;HTTP/1.1 &lt;span style="color: #666666"&gt;200&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;&lt;span style="color: #666666"&gt;{&lt;/span&gt;&lt;span style="color: #BA2121"&gt;&amp;quot;Hello&amp;quot;&lt;/span&gt;:&lt;span style="color: #BA2121"&gt;&amp;quot;World&amp;quot;&lt;/span&gt;&lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Documentation links:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#getting-started-first-application-annotations"&gt;@RestController and @RequestMapping&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/RequestMapping.html"&gt;@RequestMapping API doc&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#howto-customize-the-jackson-objectmapper"&gt;Customize Json Serialization&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Advanced endpoint configuration&lt;/h3&gt;
&lt;p&gt;Now that we have a controller, we may want to define dynamic HTTP endpoints. To do so, the main annotations to keep in mind are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;@RequestBody&lt;/code&gt; : Defines a body structure through a java Class.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@PathVariable&lt;/code&gt;: Defines a variable subpart of the endpoint URL.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@RequestParam&lt;/code&gt; : Defines a query parameter.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The controller below showcases the three annotations with two endpoints, each returning a custom “Hello World” depending on the query.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@RestController&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;/hello&amp;quot;&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;        consumes &lt;span style="color: #666666"&gt;=&lt;/span&gt; MediaType.&lt;span style="color: #7D9029"&gt;ALL_VALUE&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;        produces &lt;span style="color: #666666"&gt;=&lt;/span&gt; MediaType.&lt;span style="color: #7D9029"&gt;APPLICATION_JSON_VALUE&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;HelloWorldController&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;// The behavior is not representative of a typical POST request&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;// and only here as a matter of example.&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;&amp;quot;&lt;/span&gt;, method &lt;span style="color: #666666"&gt;=&lt;/span&gt; RequestMethod.&lt;span style="color: #7D9029"&gt;POST&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Map&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style="color: #0000FF"&gt;greetFromBody&lt;/span&gt;(&lt;span style="color: #AA22FF"&gt;@RequestBody&lt;/span&gt; HelloBody helloBody) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;        HashMap&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&lt;/span&gt; output &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; HashMap&lt;span style="color: #666666"&gt;&amp;lt;&amp;gt;&lt;/span&gt;();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;        output.&lt;span style="color: #7D9029"&gt;put&lt;/span&gt;(&lt;span style="color: #BA2121"&gt;&amp;quot;message&amp;quot;&lt;/span&gt;, &lt;span style="color: #BA2121"&gt;&amp;quot;Hello &amp;quot;&lt;/span&gt; &lt;span style="color: #666666"&gt;+&lt;/span&gt; helloBody.&lt;span style="color: #7D9029"&gt;getName&lt;/span&gt;());
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&amp;gt;&lt;/span&gt;(output, HttpStatus.&lt;span style="color: #7D9029"&gt;OK&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;/{name}&amp;quot;&lt;/span&gt;, method &lt;span style="color: #666666"&gt;=&lt;/span&gt; RequestMethod.&lt;span style="color: #7D9029"&gt;GET&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Map&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style="color: #0000FF"&gt;greet&lt;/span&gt;(&lt;span style="color: #AA22FF"&gt;@PathVariable&lt;/span&gt; String name,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;18&lt;/span&gt;                                                     &lt;span style="color: #AA22FF"&gt;@RequestParam&lt;/span&gt;(required &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;false&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;19&lt;/span&gt;                                                                   defaultValue &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;0&amp;quot;&lt;/span&gt;) &lt;span style="color: #B00040"&gt;int&lt;/span&gt; amount_exclamation) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;20&lt;/span&gt;        HashMap&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&lt;/span&gt; output &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; HashMap&lt;span style="color: #666666"&gt;&amp;lt;&amp;gt;&lt;/span&gt;();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;21&lt;/span&gt;        StringBuilder b &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; StringBuilder(&lt;span style="color: #BA2121"&gt;&amp;quot;Hello &amp;quot;&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;22&lt;/span&gt;        b.&lt;span style="color: #7D9029"&gt;append&lt;/span&gt;(name);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;23&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;for&lt;/span&gt; (&lt;span style="color: #B00040"&gt;int&lt;/span&gt; i &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #666666"&gt;0&lt;/span&gt;; i &lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt; amount_exclamation; i&lt;span style="color: #666666"&gt;++&lt;/span&gt;) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;24&lt;/span&gt;            b.&lt;span style="color: #7D9029"&gt;append&lt;/span&gt;(&lt;span style="color: #BA2121"&gt;&amp;quot;!&amp;quot;&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;25&lt;/span&gt;        }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;26&lt;/span&gt;        output.&lt;span style="color: #7D9029"&gt;put&lt;/span&gt;(&lt;span style="color: #BA2121"&gt;&amp;quot;message&amp;quot;&lt;/span&gt;, b.&lt;span style="color: #7D9029"&gt;toString&lt;/span&gt;());
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;27&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&amp;gt;&lt;/span&gt;(output, HttpStatus.&lt;span style="color: #7D9029"&gt;OK&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;28&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;29&lt;/span&gt;}
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;30&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;31&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;HelloBody&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;32&lt;/span&gt;    String name;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;33&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;34&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #0000FF"&gt;HelloBody&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;35&lt;/span&gt;        &lt;span style="color: #408080; font-style: italic"&gt;// Used by Jackson&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;36&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;37&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;38&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; String &lt;span style="color: #0000FF"&gt;getName&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;39&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;name&lt;/span&gt;;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;40&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;41&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The endpoints defined above can be used as follows:&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;curl -i &lt;span style="color: #BA2121"&gt;&amp;quot;localhost:8080/hello/jack?amount_exclamation=4&amp;quot;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;HTTP/1.1 &lt;span style="color: #666666"&gt;200&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;&lt;span style="color: #666666"&gt;{&lt;/span&gt;&lt;span style="color: #BA2121"&gt;&amp;quot;message&amp;quot;&lt;/span&gt;:&lt;span style="color: #BA2121"&gt;&amp;quot;Hello jack!!!!&amp;quot;&lt;/span&gt;&lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;4&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;5&lt;/span&gt;&lt;span style="color: #408080; font-style: italic"&gt;# -d automatically creates a POST request.&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;6&lt;/span&gt;$ curl -i &lt;span style="color: #BA2121"&gt;&amp;quot;localhost:8080/hello&amp;quot;&lt;/span&gt; -d &lt;span style="color: #BA2121"&gt;&amp;#39;{&amp;quot;name&amp;quot;: &amp;quot;Bob&amp;quot;}&amp;#39;&lt;/span&gt; -H &lt;span style="color: #BA2121"&gt;&amp;quot;Content-Type: application/json&amp;quot;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;7&lt;/span&gt;HTTP/1.1 &lt;span style="color: #666666"&gt;200&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;8&lt;/span&gt;&lt;span style="color: #666666"&gt;{&lt;/span&gt;&lt;span style="color: #BA2121"&gt;&amp;quot;message&amp;quot;&lt;/span&gt;:&lt;span style="color: #BA2121"&gt;&amp;quot;Hello Bob&amp;quot;&lt;/span&gt;&lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Documentation links:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/spring-framework-reference/web.html#mvc-ann-requestbody"&gt;@RequestBody&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/spring-framework-reference/web.html#mvc-ann-requestmapping-uri-templates"&gt;@PathVariable&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/spring-framework-reference/web.html#mvc-ann-requestparam"&gt;@RequestParam&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Handle errors&lt;/h3&gt;
&lt;p&gt;By default, Spring Boot will return the HTTP code 200 for any successful request, 404 if the endpoint is not registered, and 500 for any error. We already saw that using &lt;code&gt;ResponseEntity&lt;/code&gt; enables us to override this behavior for successful requests, but we still need to handle error codes more finely.&lt;/p&gt;
&lt;p&gt;To do so, we will define custom API exceptions that will be automatically transformed into HTTP codes. 
This transformation is done by a class extending &lt;code&gt;ResponseEntityExceptionHandler&lt;/code&gt; and annotated with &lt;code&gt;@ControllerAdvice&lt;/code&gt;. 
In this class, we can define methods to handle exceptions using the annotations &lt;code&gt;@ExceptionHandler&lt;/code&gt; and &lt;code&gt;@ResponseStatus&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@ControllerAdvice&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;MyApplicationControllerAdvice&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;extends&lt;/span&gt; ResponseEntityExceptionHandler {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@ExceptionHandler&lt;/span&gt;(ApiException.&lt;span style="color: #7D9029"&gt;class&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@ResponseStatus&lt;/span&gt;(HttpStatus.&lt;span style="color: #7D9029"&gt;BAD_REQUEST&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #B00040"&gt;void&lt;/span&gt; &lt;span style="color: #0000FF"&gt;handleBadRequest&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@ExceptionHandler&lt;/span&gt;(NotFoundException.&lt;span style="color: #7D9029"&gt;class&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@ResponseStatus&lt;/span&gt;(HttpStatus.&lt;span style="color: #7D9029"&gt;NOT_FOUND&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #B00040"&gt;void&lt;/span&gt; &lt;span style="color: #0000FF"&gt;handleNotFound&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;}
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;ApiException&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;extends&lt;/span&gt; Exception {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;}
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;18&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;NotFoundException&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;extends&lt;/span&gt; ApiException {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;19&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After defining the &lt;code&gt;ControllerAdvice&lt;/code&gt; in your project, any exception thrown by your controllers will be parsed and transformed to the bound &lt;code&gt;ResponseStatus&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@RestController&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;/exception&amp;quot;&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;ExceptionController&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;/404&amp;quot;&lt;/span&gt;, method &lt;span style="color: #666666"&gt;=&lt;/span&gt; RequestMethod.&lt;span style="color: #7D9029"&gt;GET&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Map&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style="color: #0000FF"&gt;notFound&lt;/span&gt;() &lt;span style="color: #008000; font-weight: bold"&gt;throws&lt;/span&gt; NotFoundException {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;throw&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; NotFoundException();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;    }    
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;/400&amp;quot;&lt;/span&gt;, method &lt;span style="color: #666666"&gt;=&lt;/span&gt; RequestMethod.&lt;span style="color: #7D9029"&gt;GET&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Map&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style="color: #0000FF"&gt;badRequest&lt;/span&gt;() &lt;span style="color: #008000; font-weight: bold"&gt;throws&lt;/span&gt; ApiException {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;throw&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; ApiException();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;/500&amp;quot;&lt;/span&gt;, method &lt;span style="color: #666666"&gt;=&lt;/span&gt; RequestMethod.&lt;span style="color: #7D9029"&gt;GET&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Map&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style="color: #0000FF"&gt;ise&lt;/span&gt;() &lt;span style="color: #008000; font-weight: bold"&gt;throws&lt;/span&gt; Exception {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;throw&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; Exception();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;18&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;19&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;$ curl -i &lt;span style="color: #BA2121"&gt;&amp;quot;localhost:8080/exception/500&amp;quot;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;HTTP/1.1 &lt;span style="color: #666666"&gt;500&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;4&lt;/span&gt;$ curl -i &lt;span style="color: #BA2121"&gt;&amp;quot;localhost:8080/exception/404&amp;quot;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;5&lt;/span&gt;HTTP/1.1 &lt;span style="color: #666666"&gt;404&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;6&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;7&lt;/span&gt;$ curl -i &lt;span style="color: #BA2121"&gt;&amp;quot;localhost:8080/exception/400&amp;quot;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;8&lt;/span&gt;HTTP/1.1 &lt;span style="color: #666666"&gt;400&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our exception handling is very simple and does not return any payload, but it is possible to implement exception parsing in the methods of &lt;code&gt;ResponseEntityExceptionHandler&lt;/code&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Documentation links:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-error-handling"&gt;ResponseEntityExceptionHandler&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/spring-framework-reference/web.html#mvc-ann-controller-advice"&gt;@ControllerAdvice&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/spring-framework-reference/web.html#mvc-ann-exceptionhandler"&gt;@ExceptionHandler&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/spring-framework-reference/web.html#mvc-ann-exceptionhandler-return-values"&gt;@ResponseStatus&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Connect to a persistence layer&lt;/h3&gt;
&lt;h4&gt;Configuration&lt;/h4&gt;
&lt;p&gt;To use a database, we will need the &lt;em&gt;Java Persistence API&lt;/em&gt; (JPA) package and the implementation of any persistence layer.
The former will install interface APIs, while the latter will provide the implementations and drivers.&lt;/p&gt;
&lt;p&gt;To pinpoint the minimal changes required to switch between two distinct databases, we will show the integration with both &lt;a href="https://www.postgresql.org/"&gt;PostgreSQL&lt;/a&gt; and &lt;a href="https://www.h2database.com/html/main.html"&gt;H2&lt;/a&gt; at the same time.
First, let’s declare our dependencies:&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;dependencies &lt;span style="color: #666666"&gt;{&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;  implementation &lt;span style="color: #BA2121"&gt;&amp;#39;org.springframework.boot:spring-boot-starter-data-jpa&amp;#39;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;4&lt;/span&gt;  &lt;span style="color: #408080; font-style: italic"&gt;// Dependencies to your used dbms&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;5&lt;/span&gt;  implementation &lt;span style="color: #BA2121"&gt;&amp;#39;org.postgresql:postgresql:42.2.1&amp;#39;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;6&lt;/span&gt;  implementation &lt;span style="color: #BA2121"&gt;&amp;#39;com.h2database:h2:1.4.200&amp;#39;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;7&lt;/span&gt;&lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The second step is to configure the accesses in &lt;code&gt;application.properties&lt;/code&gt;. The property file is the first and the last time we will have to worry about our persistence configuration. In this file, the 3 lines commented out are the only part to change to switch from PostgreSQL to H2.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #7D9029"&gt;spring.datasource.username&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BA2121"&gt;user&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;&lt;span style="color: #7D9029"&gt;spring.datasource.password&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BA2121"&gt;password&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;&lt;span style="color: #7D9029"&gt;spring.datasource.generate-unique-name&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BA2121"&gt;true&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;&lt;span style="color: #408080; font-style: italic"&gt;# Automatically create &amp;amp; update the database schema from code.&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;&lt;span style="color: #7D9029"&gt;spring.jpa.hibernate.ddl-auto&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BA2121"&gt;update&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;&lt;span style="color: #408080; font-style: italic"&gt;#spring.datasource.url=jdbc:h2:mem:database_name&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;&lt;span style="color: #7D9029"&gt;spring.datasource.url&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BA2121"&gt;jdbc:postgresql://localhost:5432/database_name&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;&lt;span style="color: #408080; font-style: italic"&gt;#spring.datasource.driver-class-name=org.h2.Driver&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;&lt;span style="color: #7D9029"&gt;spring.datasource.driver-class-name&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BA2121"&gt;org.postgresql.Driver&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;&lt;span style="color: #408080; font-style: italic"&gt;#spring.jpa.database-platform=org.hibernate.dialect.H2Dialect&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;&lt;span style="color: #7D9029"&gt;spring.jpa.database-platform&lt;/span&gt;&lt;span style="color: #666666"&gt;=&lt;/span&gt;&lt;span style="color: #BA2121"&gt;org.hibernate.dialect.PostgreSQL10Dialect&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Documentation links:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-configure-datasource"&gt;Database configuration&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#data-properties"&gt;Available properties&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Define a model&lt;/h4&gt;
&lt;p&gt;Defining a model is as simple as using annotations defined on &lt;a href="https://www.jcp.org/en/jsr/detail?id=317"&gt;JSR-317&lt;/a&gt;. These annotations are available through the package &lt;em&gt;javax.persistence,&lt;/em&gt; which is available through the JPA dependency.&lt;/p&gt;
&lt;p&gt;For instance, the code below creates a &lt;em&gt;Delivery&lt;/em&gt; entity. Our entity identifier is the field &lt;em&gt;id&lt;/em&gt;, which will be automatically initialized and increased on each new saved entity in the database thanks to the annotation &lt;code&gt;@GeneratedValue&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note: All attributes publicly available will be set into the JSON representation of the entity in the API responses.&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@Entity&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@Table&lt;/span&gt;(name &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;delivery&amp;quot;&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;Delivery&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@Id&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@GeneratedValue&lt;/span&gt;(strategy &lt;span style="color: #666666"&gt;=&lt;/span&gt; GenerationType.&lt;span style="color: #7D9029"&gt;AUTO&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;    &lt;span style="color: #B00040"&gt;long&lt;/span&gt; id;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@Column&lt;/span&gt;(nullable &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;false&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@NotNull&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@Enumerated&lt;/span&gt;(EnumType.&lt;span style="color: #7D9029"&gt;STRING&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;    DeliveryState state;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@Column&lt;/span&gt;(nullable &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;false&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@NotNull&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;    String location;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #0000FF"&gt;Delivery&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;18&lt;/span&gt;        &lt;span style="color: #408080; font-style: italic"&gt;// Used by Jackson2&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;19&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;20&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;21&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #0000FF"&gt;Delivery&lt;/span&gt;(&lt;span style="color: #AA22FF"&gt;@NotNull&lt;/span&gt; DeliveryState state, &lt;span style="color: #AA22FF"&gt;@NotNull&lt;/span&gt; String location) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;22&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;state&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; state;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;23&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;location&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; location;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;24&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;25&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;26&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #B00040"&gt;long&lt;/span&gt; &lt;span style="color: #0000FF"&gt;getId&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;27&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; id;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;28&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;29&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;30&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; DeliveryState &lt;span style="color: #0000FF"&gt;getState&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;31&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; state;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;32&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;33&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;34&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #B00040"&gt;void&lt;/span&gt; &lt;span style="color: #0000FF"&gt;setState&lt;/span&gt;(DeliveryState state) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;35&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;state&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; state;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;36&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;37&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;38&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; String &lt;span style="color: #0000FF"&gt;getLocation&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;39&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; location;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;40&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;41&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;42&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #B00040"&gt;void&lt;/span&gt; &lt;span style="color: #0000FF"&gt;setLocation&lt;/span&gt;(String location) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;43&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;location&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; location;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;44&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;45&lt;/span&gt;}
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;46&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;47&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;enum&lt;/span&gt; DeliveryState {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;48&lt;/span&gt;    PENDING, DELIVERING, WAITING_AT_ARRIVAL, RETURNING, RETURNED, PICKED_UP;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;49&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To ensure consistency of our data class, we applied &lt;code&gt;@NotNull&lt;/code&gt; validations from &lt;a href="https://jcp.org/en/jsr/detail?id=303"&gt;JSR-303&lt;/a&gt;, these validations can be enforced on endpoints as we will see during the next section. 
The constraints are contained in the package &lt;em&gt;javax.validation.constraints&lt;/em&gt;, available through the dependency &lt;code&gt;spring-boot-starter-validation&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;dependencies &lt;span style="color: #666666"&gt;{&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;  implementation &lt;span style="color: #BA2121"&gt;&amp;#39;org.springframework.boot:spring-boot-starter-validation&amp;#39;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;&lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Documentation links:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-entity-classes"&gt;Entity Declaration&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/package-summary.html"&gt;javax.persistence API documentation (@Entity, @Column, @Enumerate, …)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/GeneratedValue.html"&gt;@GeneratedValue&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/constraints/package-summary.html"&gt;javax.validation.constraints API documentation (@NotNull)&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;Expose the model&lt;/h4&gt;
&lt;p&gt;To interact with our models, we have to define a &lt;a href="https://docs.spring.io/spring-data/commons/docs/2.4.2/api/org/springframework/data/repository/Repository.html"&gt;Repository&lt;/a&gt;, for instance, a &lt;code&gt;CrudRepository&lt;/code&gt;.
Doing so is as easy as extending the class with an empty class. Spring Boot will automatically implement functions to interact with the entity.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@Repository&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;interface&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;DeliveryRepository&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;extends&lt;/span&gt; CrudRepository&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Delivery, Long&lt;span style="color: #666666"&gt;&amp;gt;&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We annotate this component &lt;code&gt;@Repository&lt;/code&gt; to make it available to dependency injection. 
Then we can inject and use the repository in any class, for example directly in a controller. 
Using&lt;code&gt;@Autowired&lt;/code&gt; will automatically retrieve the &lt;code&gt;@Repository&lt;/code&gt; declared above_._&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Note:&lt;/em&gt; &lt;code&gt;_@Repository_&lt;/code&gt; &lt;em&gt;and&lt;/em&gt; &lt;code&gt;_@Service_&lt;/code&gt; &lt;em&gt;behave exactly as the main injection annotation&lt;/em&gt;&lt;code&gt;_@Component_&lt;/code&gt;&lt;em&gt;, it simply enables to mark a semantic difference.&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@RestController&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;/delivery&amp;quot;&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;        consumes &lt;span style="color: #666666"&gt;=&lt;/span&gt; MediaType.&lt;span style="color: #7D9029"&gt;APPLICATION_JSON_VALUE&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;        produces &lt;span style="color: #666666"&gt;=&lt;/span&gt; MediaType.&lt;span style="color: #7D9029"&gt;APPLICATION_JSON_VALUE&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;DeliveryController&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;private&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;final&lt;/span&gt; DeliveryRepository deliveryRepository;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@Autowired&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #0000FF"&gt;DeliveryController&lt;/span&gt;(DeliveryRepository deliveryRepository) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;deliveryRepository&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; deliveryRepository;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;&amp;quot;&lt;/span&gt;, method &lt;span style="color: #666666"&gt;=&lt;/span&gt; RequestMethod.&lt;span style="color: #7D9029"&gt;POST&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Delivery&lt;span style="color: #666666"&gt;&amp;gt;&lt;/span&gt; &lt;span style="color: #0000FF"&gt;post&lt;/span&gt;(&lt;span style="color: #AA22FF"&gt;@Valid&lt;/span&gt; &lt;span style="color: #AA22FF"&gt;@RequestBody&lt;/span&gt; Delivery delivery) &lt;span style="color: #008000; font-weight: bold"&gt;throws&lt;/span&gt; ApiException {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;try&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;            delivery &lt;span style="color: #666666"&gt;=&lt;/span&gt; deliveryRepository.&lt;span style="color: #7D9029"&gt;save&lt;/span&gt;(delivery);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;18&lt;/span&gt;        } &lt;span style="color: #008000; font-weight: bold"&gt;catch&lt;/span&gt; (Exception e) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;19&lt;/span&gt;            &lt;span style="color: #008000; font-weight: bold"&gt;throw&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; ApiException();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;20&lt;/span&gt;        }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;21&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&amp;gt;&lt;/span&gt;(delivery, HttpStatus.&lt;span style="color: #7D9029"&gt;OK&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;22&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;23&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;24&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;/{id}&amp;quot;&lt;/span&gt;, method &lt;span style="color: #666666"&gt;=&lt;/span&gt; RequestMethod.&lt;span style="color: #7D9029"&gt;GET&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;25&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Delivery&lt;span style="color: #666666"&gt;&amp;gt;&lt;/span&gt; &lt;span style="color: #0000FF"&gt;get&lt;/span&gt;(&lt;span style="color: #AA22FF"&gt;@PathVariable&lt;/span&gt; &lt;span style="color: #B00040"&gt;long&lt;/span&gt; id) &lt;span style="color: #008000; font-weight: bold"&gt;throws&lt;/span&gt; ApiException {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;26&lt;/span&gt;        Optional&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Delivery&lt;span style="color: #666666"&gt;&amp;gt;&lt;/span&gt; delivery &lt;span style="color: #666666"&gt;=&lt;/span&gt; deliveryRepository.&lt;span style="color: #7D9029"&gt;findById&lt;/span&gt;(id);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;27&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;if&lt;/span&gt; (delivery.&lt;span style="color: #7D9029"&gt;isEmpty&lt;/span&gt;()) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;28&lt;/span&gt;            &lt;span style="color: #008000; font-weight: bold"&gt;throw&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; NotFoundException();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;29&lt;/span&gt;        }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;30&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&amp;gt;&lt;/span&gt;(delivery.&lt;span style="color: #7D9029"&gt;get&lt;/span&gt;(), HttpStatus.&lt;span style="color: #7D9029"&gt;OK&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;31&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;32&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We used the annotation&lt;code&gt;@Valid&lt;/code&gt; to ensure that our constraints defined above are met on the sent &lt;em&gt;Delivery&lt;/em&gt; body.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;$ curl -i &lt;span style="color: #BA2121"&gt;&amp;quot;localhost:8080/delivery&amp;quot;&lt;/span&gt; -H &lt;span style="color: #BA2121"&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;  -X POST -d &lt;span style="color: #BA2121"&gt;&amp;#39;{&amp;quot;state&amp;quot;: &amp;quot;PENDING&amp;quot;}&amp;#39;&lt;/span&gt;                  
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;HTTP/1.1 &lt;span style="color: #666666"&gt;400&lt;/span&gt; 
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;$ curl -i &lt;span style="color: #BA2121"&gt;&amp;quot;localhost:8080/delivery/1&amp;quot;&lt;/span&gt; -H &lt;span style="color: #BA2121"&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;HTTP/1.1 &lt;span style="color: #666666"&gt;404&lt;/span&gt; 
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;$ curl -i &lt;span style="color: #BA2121"&gt;&amp;quot;localhost:8080/delivery&amp;quot;&lt;/span&gt; -H &lt;span style="color: #BA2121"&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; &lt;span style="color: #BB6622; font-weight: bold"&gt;\&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;  -X POST -d &lt;span style="color: #BA2121"&gt;&amp;#39;{&amp;quot;state&amp;quot;: &amp;quot;PENDING&amp;quot;, &amp;quot;location&amp;quot;:&amp;quot;Budapest&amp;quot;}&amp;#39;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;HTTP/1.1 &lt;span style="color: #666666"&gt;200&lt;/span&gt; 
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;&lt;span style="color: #666666"&gt;{&lt;/span&gt;&lt;span style="color: #BA2121"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;:1,&lt;span style="color: #BA2121"&gt;&amp;quot;state&amp;quot;&lt;/span&gt;:&lt;span style="color: #BA2121"&gt;&amp;quot;PENDING&amp;quot;&lt;/span&gt;,&lt;span style="color: #BA2121"&gt;&amp;quot;location&amp;quot;&lt;/span&gt;:&lt;span style="color: #BA2121"&gt;&amp;quot;Budapest&amp;quot;&lt;/span&gt;&lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;$ curl -i &lt;span style="color: #BA2121"&gt;&amp;quot;localhost:8080/delivery/1&amp;quot;&lt;/span&gt; -H &lt;span style="color: #BA2121"&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt;                                                                                 &lt;span style="color: #666666"&gt;130&lt;/span&gt; ↵
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;HTTP/1.1 &lt;span style="color: #666666"&gt;200&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;&lt;span style="color: #666666"&gt;{&lt;/span&gt;&lt;span style="color: #BA2121"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;:1,&lt;span style="color: #BA2121"&gt;&amp;quot;state&amp;quot;&lt;/span&gt;:&lt;span style="color: #BA2121"&gt;&amp;quot;PENDING&amp;quot;&lt;/span&gt;,&lt;span style="color: #BA2121"&gt;&amp;quot;location&amp;quot;&lt;/span&gt;:&lt;span style="color: #BA2121"&gt;&amp;quot;Budapest&amp;quot;&lt;/span&gt;&lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Note: H2 is an in-memory database so the data will be wiped out at each server restart.&lt;/em&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Documentation Links:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-data/commons/docs/2.4.2/api/org/springframework/data/repository/CrudRepository.html"&gt;CrudRepository API Documentation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#using-boot-spring-beans-and-dependency-injection"&gt;Spring Component Declaration&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/package-summary.html"&gt;javax.validation API documentation (@Valid)&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Paginate the results&lt;/h3&gt;
&lt;p&gt;This section illustrates how well Spring Boot integrates some classic features of a web API. 
To paginate the access to our previous entity &lt;em&gt;Delivery,&lt;/em&gt; we simply have to change the repository’s extended class from &lt;code&gt;CrudRepository&lt;/code&gt; to &lt;code&gt;PagingAndSortingRepository&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@Repository&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;interface&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;DeliveryRepository&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;extends&lt;/span&gt; PagingAndSortingRepository&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Delivery, Long&lt;span style="color: #666666"&gt;&amp;gt;&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This repository implementation provides a new method &lt;code&gt;findAll(Pageable)&lt;/code&gt; returning a &lt;code&gt;Page&lt;/code&gt;. 
The class &lt;code&gt;Pageable&lt;/code&gt; configures the page and page size to return.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@RestController&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;/delivery&amp;quot;&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;        consumes &lt;span style="color: #666666"&gt;=&lt;/span&gt; MediaType.&lt;span style="color: #7D9029"&gt;APPLICATION_JSON_VALUE&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;        produces &lt;span style="color: #666666"&gt;=&lt;/span&gt; MediaType.&lt;span style="color: #7D9029"&gt;APPLICATION_JSON_VALUE&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;DeliveryController&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;private&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;final&lt;/span&gt; DeliveryRepository deliveryRepository;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@Autowired&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #0000FF"&gt;DeliveryController&lt;/span&gt;(DeliveryRepository deliveryRepository) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;deliveryRepository&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; deliveryRepository;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;&amp;quot;&lt;/span&gt;, method &lt;span style="color: #666666"&gt;=&lt;/span&gt; RequestMethod.&lt;span style="color: #7D9029"&gt;GET&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Page&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;Delivery&lt;span style="color: #666666"&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span style="color: #0000FF"&gt;index&lt;/span&gt;(&lt;span style="color: #AA22FF"&gt;@RequestParam&lt;/span&gt;(required &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;false&lt;/span&gt;, defaultValue &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;0&amp;quot;&lt;/span&gt;) &lt;span style="color: #B00040"&gt;int&lt;/span&gt; page) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;        Pageable pageable &lt;span style="color: #666666"&gt;=&lt;/span&gt; PageRequest.&lt;span style="color: #7D9029"&gt;of&lt;/span&gt;(page, &lt;span style="color: #666666"&gt;50&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; ResponseEntity&lt;span style="color: #666666"&gt;&amp;lt;&amp;gt;&lt;/span&gt;(deliveryRepository.&lt;span style="color: #7D9029"&gt;findAll&lt;/span&gt;(pageable), HttpStatus.&lt;span style="color: #7D9029"&gt;OK&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;18&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;19&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The endpoint will then serve the whole &lt;code&gt;Page&lt;/code&gt; object’s data upon request.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;$ curl &lt;span style="color: #BA2121"&gt;&amp;quot;localhost:8080/delivery&amp;quot;&lt;/span&gt; -H &lt;span style="color: #BA2121"&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; | jq                                                                                   &lt;span style="color: #666666"&gt;4&lt;/span&gt; ↵
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;&lt;span style="color: #666666"&gt;{&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;  &lt;span style="color: #BA2121"&gt;&amp;quot;content&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;[&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;    &lt;span style="color: #666666"&gt;{&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;      &lt;span style="color: #BA2121"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;1&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;      &lt;span style="color: #BA2121"&gt;&amp;quot;state&amp;quot;&lt;/span&gt;: &lt;span style="color: #BA2121"&gt;&amp;quot;PENDING&amp;quot;&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;      &lt;span style="color: #BA2121"&gt;&amp;quot;location&amp;quot;&lt;/span&gt;: &lt;span style="color: #BA2121"&gt;&amp;quot;Budapest&amp;quot;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;    &lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;  &lt;span style="color: #666666"&gt;]&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;  &lt;span style="color: #BA2121"&gt;&amp;quot;pageable&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;{&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;    &lt;span style="color: #BA2121"&gt;&amp;quot;sort&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;{&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;      &lt;span style="color: #BA2121"&gt;&amp;quot;sorted&amp;quot;&lt;/span&gt;: false,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;      &lt;span style="color: #BA2121"&gt;&amp;quot;unsorted&amp;quot;&lt;/span&gt;: true,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;      &lt;span style="color: #BA2121"&gt;&amp;quot;empty&amp;quot;&lt;/span&gt;: &lt;span style="color: #008000"&gt;true&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;    &lt;span style="color: #666666"&gt;}&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;    &lt;span style="color: #BA2121"&gt;&amp;quot;offset&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;0&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;    &lt;span style="color: #BA2121"&gt;&amp;quot;pageNumber&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;0&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;18&lt;/span&gt;    &lt;span style="color: #BA2121"&gt;&amp;quot;pageSize&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;50&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;19&lt;/span&gt;    &lt;span style="color: #BA2121"&gt;&amp;quot;paged&amp;quot;&lt;/span&gt;: true,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;20&lt;/span&gt;    &lt;span style="color: #BA2121"&gt;&amp;quot;unpaged&amp;quot;&lt;/span&gt;: &lt;span style="color: #008000"&gt;false&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;21&lt;/span&gt;  &lt;span style="color: #666666"&gt;}&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;22&lt;/span&gt;  &lt;span style="color: #BA2121"&gt;&amp;quot;totalPages&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;1&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;23&lt;/span&gt;  &lt;span style="color: #BA2121"&gt;&amp;quot;totalElements&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;1&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;24&lt;/span&gt;  &lt;span style="color: #BA2121"&gt;&amp;quot;last&amp;quot;&lt;/span&gt;: true,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;25&lt;/span&gt;  &lt;span style="color: #BA2121"&gt;&amp;quot;first&amp;quot;&lt;/span&gt;: true,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;26&lt;/span&gt;  &lt;span style="color: #BA2121"&gt;&amp;quot;size&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;50&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;27&lt;/span&gt;  &lt;span style="color: #BA2121"&gt;&amp;quot;number&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;0&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;28&lt;/span&gt;  &lt;span style="color: #BA2121"&gt;&amp;quot;sort&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;{&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;29&lt;/span&gt;    &lt;span style="color: #BA2121"&gt;&amp;quot;sorted&amp;quot;&lt;/span&gt;: false,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;30&lt;/span&gt;    &lt;span style="color: #BA2121"&gt;&amp;quot;unsorted&amp;quot;&lt;/span&gt;: true,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;31&lt;/span&gt;    &lt;span style="color: #BA2121"&gt;&amp;quot;empty&amp;quot;&lt;/span&gt;: &lt;span style="color: #008000"&gt;true&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;32&lt;/span&gt;  &lt;span style="color: #666666"&gt;}&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;33&lt;/span&gt;  &lt;span style="color: #BA2121"&gt;&amp;quot;numberOfElements&amp;quot;&lt;/span&gt;: &lt;span style="color: #666666"&gt;1&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;34&lt;/span&gt;  &lt;span style="color: #BA2121"&gt;&amp;quot;empty&amp;quot;&lt;/span&gt;: &lt;span style="color: #008000"&gt;false&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;35&lt;/span&gt;&lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Documentation links:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-data/commons/docs/2.4.2/api/org/springframework/data/repository/PagingAndSortingRepository.html"&gt;PagingAndSortingRepository API Documentation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-data/commons/docs/2.4.2/api/org/springframework/data/domain/PageRequest.html"&gt;PageRequest API Documentation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-data/commons/docs/2.4.2/api/org/springframework/data/domain/Page.html"&gt;Page API Documentation&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Test the application&lt;/h3&gt;
&lt;p&gt;Spring Boot provides every tool to easily test controllers with a set of APIs and &lt;a href="https://en.wikipedia.org/wiki/Mock_object"&gt;mocks&lt;/a&gt;. 
Mostly, &lt;code&gt;MockMvc&lt;/code&gt; will enable us to send requests and assert response content without having to worry about technicalities.&lt;/p&gt;
&lt;p&gt;As an example, we are testing the &lt;em&gt;POST&lt;/em&gt; endpoint from the section above. One of these tests is successfully creating a &lt;em&gt;Delivery&lt;/em&gt; entity, and the second one simulates an error coming from the database.&lt;/p&gt;
&lt;p&gt;To avoid relying on a physical instance of a persistence layer, we injected our DeliveryRepository instance using &lt;code&gt;@MockBean&lt;/code&gt;, which creates and injects a mock of our component.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@SpringBootTest&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;&lt;span style="color: #AA22FF"&gt;@AutoConfigureMockMvc&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;DeliveryControllerTest&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@Autowired&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;private&lt;/span&gt; MockMvc mvc;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@MockBean&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;    DeliveryRepository deliveryRepository;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@Test&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;    &lt;span style="color: #B00040"&gt;void&lt;/span&gt; &lt;span style="color: #0000FF"&gt;testPostDeliveryOk&lt;/span&gt;() &lt;span style="color: #008000; font-weight: bold"&gt;throws&lt;/span&gt; Exception {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;        ObjectMapper mapper &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; ObjectMapper();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;        Map&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&lt;/span&gt; delivery &lt;span style="color: #666666"&gt;=&lt;/span&gt; getValidDelivery();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;        String body &lt;span style="color: #666666"&gt;=&lt;/span&gt; mapper.&lt;span style="color: #7D9029"&gt;writeValueAsString&lt;/span&gt;(delivery);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;        MockHttpServletRequestBuilder accept &lt;span style="color: #666666"&gt;=&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;                MockMvcRequestBuilders.&lt;span style="color: #7D9029"&gt;post&lt;/span&gt;(&lt;span style="color: #BA2121"&gt;&amp;quot;/delivery&amp;quot;&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;                        .&lt;span style="color: #7D9029"&gt;accept&lt;/span&gt;(MediaType.&lt;span style="color: #7D9029"&gt;APPLICATION_JSON&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;18&lt;/span&gt;                        .&lt;span style="color: #7D9029"&gt;contentType&lt;/span&gt;(MediaType.&lt;span style="color: #7D9029"&gt;APPLICATION_JSON&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;19&lt;/span&gt;                        .&lt;span style="color: #7D9029"&gt;content&lt;/span&gt;(body);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;20&lt;/span&gt;        mvc.&lt;span style="color: #7D9029"&gt;perform&lt;/span&gt;(accept).&lt;span style="color: #7D9029"&gt;andExpect&lt;/span&gt;(status().&lt;span style="color: #7D9029"&gt;isOk&lt;/span&gt;());
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;21&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;22&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;23&lt;/span&gt;    &lt;span style="color: #AA22FF"&gt;@Test&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;24&lt;/span&gt;    &lt;span style="color: #B00040"&gt;void&lt;/span&gt; &lt;span style="color: #0000FF"&gt;testPostPersistIssue&lt;/span&gt;() &lt;span style="color: #008000; font-weight: bold"&gt;throws&lt;/span&gt; Exception {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;25&lt;/span&gt;        ObjectMapper mapper &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; ObjectMapper();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;26&lt;/span&gt;        Map&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&lt;/span&gt; delivery &lt;span style="color: #666666"&gt;=&lt;/span&gt; getValidDelivery();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;27&lt;/span&gt;        String body &lt;span style="color: #666666"&gt;=&lt;/span&gt; mapper.&lt;span style="color: #7D9029"&gt;writeValueAsString&lt;/span&gt;(delivery);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;28&lt;/span&gt;        Mockito.&lt;span style="color: #7D9029"&gt;when&lt;/span&gt;(deliveryRepository.&lt;span style="color: #7D9029"&gt;save&lt;/span&gt;(Mockito.&lt;span style="color: #7D9029"&gt;any&lt;/span&gt;())).&lt;span style="color: #7D9029"&gt;thenThrow&lt;/span&gt;(&lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; RuntimeException());
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;29&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;30&lt;/span&gt;        MockHttpServletRequestBuilder accept &lt;span style="color: #666666"&gt;=&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;31&lt;/span&gt;                MockMvcRequestBuilders.&lt;span style="color: #7D9029"&gt;post&lt;/span&gt;(&lt;span style="color: #BA2121"&gt;&amp;quot;/delivery&amp;quot;&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;32&lt;/span&gt;                        .&lt;span style="color: #7D9029"&gt;accept&lt;/span&gt;(MediaType.&lt;span style="color: #7D9029"&gt;APPLICATION_JSON&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;33&lt;/span&gt;                        .&lt;span style="color: #7D9029"&gt;contentType&lt;/span&gt;(MediaType.&lt;span style="color: #7D9029"&gt;APPLICATION_JSON&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;34&lt;/span&gt;                        .&lt;span style="color: #7D9029"&gt;content&lt;/span&gt;(body);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;35&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;36&lt;/span&gt;        mvc.&lt;span style="color: #7D9029"&gt;perform&lt;/span&gt;(accept).&lt;span style="color: #7D9029"&gt;andExpect&lt;/span&gt;(status().&lt;span style="color: #7D9029"&gt;is4xxClientError&lt;/span&gt;());
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;37&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;38&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;39&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;private&lt;/span&gt; Map&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&lt;/span&gt; &lt;span style="color: #0000FF"&gt;getValidDelivery&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;40&lt;/span&gt;        Map&lt;span style="color: #666666"&gt;&amp;lt;&lt;/span&gt;String, String&lt;span style="color: #666666"&gt;&amp;gt;&lt;/span&gt; delivery &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; HashMap&lt;span style="color: #666666"&gt;&amp;lt;&amp;gt;&lt;/span&gt;();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;41&lt;/span&gt;        delivery.&lt;span style="color: #7D9029"&gt;put&lt;/span&gt;(&lt;span style="color: #BA2121"&gt;&amp;quot;state&amp;quot;&lt;/span&gt;, &lt;span style="color: #BA2121"&gt;&amp;quot;PENDING&amp;quot;&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;42&lt;/span&gt;        delivery.&lt;span style="color: #7D9029"&gt;put&lt;/span&gt;(&lt;span style="color: #BA2121"&gt;&amp;quot;location&amp;quot;&lt;/span&gt;, &lt;span style="color: #BA2121"&gt;&amp;quot;Rome&amp;quot;&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;43&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; delivery;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;44&lt;/span&gt;    }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;45&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Documentation links:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-testing-spring-boot-applications"&gt;@SpringBootTest&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-with-mock-environment"&gt;@AutoConfiguredMockMvc&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-testing-spring-boot-applications-mocking-beans"&gt;@MockBean&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/web/servlet/MockMvc.html"&gt;MockMvc api Documentation&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Package the application&lt;/h3&gt;
&lt;p&gt;Spring boot also eases the application packaging either as a standalone jar or a docker image.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;To create a ready to run &lt;em&gt;fat jar&lt;/em&gt;, execute &lt;code&gt;./gradlew bootJar&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;To build a &lt;em&gt;docker image&lt;/em&gt;, execute &lt;code&gt;./gradlew bootBuildImage&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note that docker does not like uppercase characters in the image name, but we can easily customize the image name and version.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;&lt;span style="color: #408080; font-style: italic"&gt;// Only use lowercase on docker image name&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;tasks&lt;span style="color: #666666"&gt;.&lt;/span&gt;&lt;span style="color: #7D9029"&gt;named&lt;/span&gt;&lt;span style="color: #666666"&gt;(&lt;/span&gt;&lt;span style="color: #BA2121"&gt;&amp;quot;bootBuildImage&amp;quot;&lt;/span&gt;&lt;span style="color: #666666"&gt;)&lt;/span&gt; &lt;span style="color: #666666"&gt;{&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;    imageName &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;${rootProject.name.toLowerCase()}:${version}&amp;quot;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;4&lt;/span&gt;&lt;span style="color: #666666"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;Documentation links:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#getting-started-first-application-executable-jar"&gt;Create an application fat jar&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-container-images"&gt;Configure Docker Image&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;Spring Boot can be used with a handful of annotations and will manage most of the configuration for you. 
However, most of the configuration can be overridden to provide your own behavior if necessary. 
This makes it a good framework to design proof of concepts while keeping room for optimization if the project grows specific needs.&lt;/p&gt;
&lt;p&gt;If you want to know more about the framework, I can’t stress enough the quality of the &lt;a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/"&gt;Reference Documentation&lt;/a&gt;, which gives really good details.&lt;/p&gt;
&lt;p&gt;If you want to play around with some code, you can find all those concepts on an example delivery API &lt;a href="https://github.com/aveuiller/frameworks-bootstrap/tree/master/SpringBoot"&gt;on GitHub&lt;/a&gt;.&lt;/p&gt;</content><category term="Software Engineering"></category><category term="Cheat sheet"></category></entry><entry><title>Introduction to Flaky Tests by Example</title><link href="https://aveuiller.github.io/introduction_to_flaky_tests_by_example.html" rel="alternate"></link><published>2020-08-10T00:00:00+02:00</published><updated>2020-08-10T00:00:00+02:00</updated><author><name>Antoine Veuiller</name></author><id>tag:aveuiller.github.io,2020-08-10:/introduction_to_flaky_tests_by_example.html</id><summary type="html">&lt;p&gt;Some real world examples of flaky tests&lt;/p&gt;</summary><content type="html">&lt;h3&gt;Availability Disclaimer&lt;/h3&gt;
&lt;p&gt;This article can be found on other sources:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Medium: &lt;a href="https://medium.com/@aveuiller/stories-of-flaky-test-encounters-in-the-wild-a152bf7151f5"&gt;Canonical link&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img alt="Flakiness effect" src="https://cdn-images-1.medium.com/max/800/1*Fg6u08KdLaqYd4dJsS_Row.gif" /&gt;&lt;/p&gt;
&lt;p&gt;Tests are an essential part of software development as they give a ground truth about the code sanity. As developers, we reasonably expect our unit tests to give the same results if the source code does not change. It can happen, however, that the result of a unit test changes over multiple executions of a test suite without any change in the code. Such a test is named a flaky test.&lt;/p&gt;
&lt;p&gt;A flaky test is not dangerous &lt;em&gt;per se&lt;/em&gt; but reduces the confidence a developer can give to his test suite, diminishing the benefits of the latter. It is thus recommended to eradicate such issue as soon as possible.&lt;/p&gt;
&lt;p&gt;However, depending on the origin of the flakiness, one may find out only a few days, months or even years later that the tests are flaky.
It may be hard to dive back into those and find the root causes, &lt;a href="https://martinfowler.com/articles/nonDeterminism.html"&gt;so usually, we tend to put those tests aside to make them less annoying or we rerun them until success&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Fingers crossed" src="https://cdn-images-1.medium.com/max/800/1*eFhEUMDPbFZbJyh66G1hQQ.gif" /&gt;&lt;/p&gt;
&lt;p&gt;As a real-world example of flaky tests and the logic behind their resolution. I will talk about two interesting cases I had the opportunity to fix during my career.&lt;/p&gt;
&lt;h3&gt;Storytime!&lt;/h3&gt;
&lt;p&gt;During my career, I stumbled onto a couple of flaky tests issues. There are two instances that, in my opinion, are quite symptomatic of test flakiness, with quite different contexts.&lt;/p&gt;
&lt;p&gt;The examples are voluntary adapted to a simpler context than the original ones to keep a short and focused article.&lt;/p&gt;
&lt;h4&gt;Story 1: 5 days a month isn’t a big deal&lt;/h4&gt;
&lt;p&gt;I entered a project where continuous integration was broken during the 5 first days of each month. 
I was told that this wasn’t a big deal since we don’t need to deploy this project at the beginning of a month.
The priority of fixing those tests was so low that it has remained like this for years before we took the time to tackle this issue.&lt;/p&gt;
&lt;p&gt;&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;add_data&lt;/span&gt;(input_datetime, data):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# Store the data along with the input date&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# [...]&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;retrieve_data&lt;/span&gt;(lower_date):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# Retrieve all data from lower date to now &lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# [...]&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;compute_stats&lt;/span&gt;():
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# Compute some statistics about stored data&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;    month &lt;span style="color: #666666"&gt;=&lt;/span&gt; arrow&lt;span style="color: #666666"&gt;.&lt;/span&gt;get()&lt;span style="color: #666666"&gt;.&lt;/span&gt;floor(&lt;span style="color: #BA2121"&gt;&amp;#39;month&amp;#39;&lt;/span&gt;) 
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;    data &lt;span style="color: #666666"&gt;=&lt;/span&gt; retrieve_data(month)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #008000"&gt;len&lt;/span&gt;(data)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;test_compute_stats&lt;/span&gt;():
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# Test method checking the behaviour of compute_stats&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;    now &lt;span style="color: #666666"&gt;=&lt;/span&gt; arrow&lt;span style="color: #666666"&gt;.&lt;/span&gt;get()
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;18&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;19&lt;/span&gt;    add_data(now&lt;span style="color: #666666"&gt;.&lt;/span&gt;shift(days&lt;span style="color: #666666"&gt;=-5&lt;/span&gt;))
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;20&lt;/span&gt;    add_data(now&lt;span style="color: #666666"&gt;.&lt;/span&gt;shift(days&lt;span style="color: #666666"&gt;=-1&lt;/span&gt;))
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;21&lt;/span&gt;    stat &lt;span style="color: #666666"&gt;=&lt;/span&gt; compute_stats()
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;22&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;23&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;assert&lt;/span&gt; stat &lt;span style="color: #666666"&gt;==&lt;/span&gt; &lt;span style="color: #666666"&gt;2&lt;/span&gt;, &lt;span style="color: #BA2121"&gt;&amp;quot;We retrieve the two data input&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
The faulty feature was computing statistics about the current month. As the developer creating the initial tests wanted to take all cases into consideration, he created a test that gave as input multiple dates relative to the current &lt;em&gt;datetime&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Among those inputs, one was &lt;em&gt;5 days before the current date,&lt;/em&gt; and the test was always computing the statistics as if it was part of the same month. As a result, it led to the tests being faulty at the beginning of each month. We can then imagine that the flakiness was detected under one to three weeks after the feature development and from then on, ignored.&lt;/p&gt;
&lt;p&gt;This test is time-dependent because &lt;em&gt;compute_stats&lt;/em&gt; will call for the date of analysis itself. As a result, the computation will always be dependent on the current date. One way of fixing such issues would be to sandbox the execution of the tests in order to control the current date.&lt;/p&gt;
&lt;p&gt;At first, we wanted to rely on &lt;a href="https://medium.com/swlh/about-design-patterns-dependency-injection-ab9c1742d4aa"&gt;dependency injection&lt;/a&gt; and make &lt;em&gt;compute_stats&lt;/em&gt; ask for a month to compute the statistics. This would create an easy way of sandboxing the execution and also potentially open the door to new features. However, in this project, this wasn’t trivial to implement because there was a lot of code dependent on this feature.&lt;/p&gt;
&lt;p&gt;Another way of doing so would be to inject the value directly to the method. Python has a very good library to sandbox the tests when using the built-in &lt;em&gt;datetime&lt;/em&gt; objects: &lt;a href="https://github.com/spulec/freezegun"&gt;freezegun&lt;/a&gt;. Once again, and unfortunately for us, the project was using &lt;a href="https://github.com/crsmithdev/arrow"&gt;arrow&lt;/a&gt; so this was not a possibility.&lt;/p&gt;
&lt;p&gt;Fortunately, and thanks to some previously well-thought environment on the project, we had a central method to provide the current date, which was initially intended to prevent the use of a wrong timezone.&lt;/p&gt;
&lt;p&gt;By mixing this method to the awesome &lt;a href="https://docs.python.org/3/library/unittest.mock.html#the-patchers"&gt;patch decorator&lt;/a&gt; of python mock library (which is part of the standard &lt;em&gt;unittest&lt;/em&gt; library since 3.3), we solved the issue with a simple modification.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;add_data&lt;/span&gt;(input_datetime, data):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# Store the data along with the input date&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# [...]&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;retrieve_data&lt;/span&gt;(lower_date):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# Retrieve all data from lower date to now &lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# [...]&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;compute_stats&lt;/span&gt;():
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# Compute some statistics about stored data&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;    month &lt;span style="color: #666666"&gt;=&lt;/span&gt; arrow&lt;span style="color: #666666"&gt;.&lt;/span&gt;get()&lt;span style="color: #666666"&gt;.&lt;/span&gt;floor(&lt;span style="color: #BA2121"&gt;&amp;#39;month&amp;#39;&lt;/span&gt;) 
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;    data &lt;span style="color: #666666"&gt;=&lt;/span&gt; retrieve_data(month)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #008000"&gt;len&lt;/span&gt;(data)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;test_compute_stats&lt;/span&gt;():
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# Test method checking the behaviour of compute_stats&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;    now &lt;span style="color: #666666"&gt;=&lt;/span&gt; arrow&lt;span style="color: #666666"&gt;.&lt;/span&gt;get()
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;18&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;19&lt;/span&gt;    add_data(now&lt;span style="color: #666666"&gt;.&lt;/span&gt;shift(days&lt;span style="color: #666666"&gt;=-5&lt;/span&gt;))
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;20&lt;/span&gt;    add_data(now&lt;span style="color: #666666"&gt;.&lt;/span&gt;shift(days&lt;span style="color: #666666"&gt;=-1&lt;/span&gt;))
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;21&lt;/span&gt;    stat &lt;span style="color: #666666"&gt;=&lt;/span&gt; compute_stats()
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;22&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;23&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;assert&lt;/span&gt; stat &lt;span style="color: #666666"&gt;==&lt;/span&gt; &lt;span style="color: #666666"&gt;2&lt;/span&gt;, &lt;span style="color: #BA2121"&gt;&amp;quot;We retrieve the two data input&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By sandboxing the execution to a given point in time, we ensured the reproducibility of the build at any given time.&lt;/p&gt;
&lt;h4&gt;Story 2: We use that configuration!&lt;/h4&gt;
&lt;p&gt;In another project, while creating a new feature we happened to break tests unrelated to our changes. This case could have been tedious to pinpoint, fortunately, due to the project organization, we were certain that the new feature did not affect the code covered by the now failing tests.&lt;/p&gt;
&lt;p&gt;The code below is a synthetic representation of what happened, a global &lt;em&gt;config&lt;/em&gt; object was interacting with both the existing and new features.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #408080; font-style: italic"&gt;# Global state configuration&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;config &lt;span style="color: #666666"&gt;=&lt;/span&gt; {}
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;existing_feature&lt;/span&gt;():
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;if&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;common_entry&amp;quot;&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;not&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;in&lt;/span&gt; config:
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;raise&lt;/span&gt; &lt;span style="color: #D2413A; font-weight: bold"&gt;ValueError&lt;/span&gt;(&lt;span style="color: #BA2121"&gt;&amp;quot;Not configured&amp;quot;&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# Process [...]&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;True&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;our_new_feature&lt;/span&gt;():
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;if&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;common_entry&amp;quot;&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;not&lt;/span&gt; &lt;span style="color: #AA22FF; font-weight: bold"&gt;in&lt;/span&gt; config:
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;        &lt;span style="color: #008000; font-weight: bold"&gt;raise&lt;/span&gt; &lt;span style="color: #D2413A; font-weight: bold"&gt;ValueError&lt;/span&gt;(&lt;span style="color: #BA2121"&gt;&amp;quot;Not configured&amp;quot;&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;# Process [...]&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;return&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;True&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;From the isolation of the two features, we knew that the new tests had to be the ones creating a faulty global state. There were globally two possibilities for the faulty state.
Either the new test was injecting something new to the global state, or removing something essential to the existing test.&lt;/p&gt;
&lt;p&gt;The test cases below were always run in the specific order &lt;em&gt;ConfiguredFeatureTest, ExistingFeatureTestCase&lt;/em&gt; before integrating the new feature, then in the order &lt;em&gt;ConfiguredFeatureTest, NewFeatureTestCase, ExistingFeatureTestCase.&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;ConfiguredFeatureTest&lt;/span&gt;(unittest&lt;span style="color: #666666"&gt;.&lt;/span&gt;TestCase):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;setUp&lt;/span&gt;(&lt;span style="color: #008000"&gt;self&lt;/span&gt;):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;        config[&lt;span style="color: #BA2121"&gt;&amp;quot;entry&amp;quot;&lt;/span&gt;] &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;anything&amp;quot;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;test_configured&lt;/span&gt;(&lt;span style="color: #008000"&gt;self&lt;/span&gt;):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;        &lt;span style="color: #008000"&gt;self&lt;/span&gt;&lt;span style="color: #666666"&gt;.&lt;/span&gt;assertIsNotNone(config&lt;span style="color: #666666"&gt;.&lt;/span&gt;get(&lt;span style="color: #BA2121"&gt;&amp;quot;entry&amp;quot;&lt;/span&gt;))
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;ExistingFeatureTestCase&lt;/span&gt;(unittest&lt;span style="color: #666666"&gt;.&lt;/span&gt;TestCase):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;test_feature_one&lt;/span&gt;(&lt;span style="color: #008000"&gt;self&lt;/span&gt;):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;        &lt;span style="color: #008000"&gt;self&lt;/span&gt;&lt;span style="color: #666666"&gt;.&lt;/span&gt;assertTrue(existing_feature())
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;NewFeatureTestCase&lt;/span&gt;(unittest&lt;span style="color: #666666"&gt;.&lt;/span&gt;TestCase):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;setUp&lt;/span&gt;(&lt;span style="color: #008000"&gt;self&lt;/span&gt;):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;        config[&lt;span style="color: #BA2121"&gt;&amp;quot;entry&amp;quot;&lt;/span&gt;] &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;anything&amp;quot;&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;18&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;tearDown&lt;/span&gt;(&lt;span style="color: #008000"&gt;self&lt;/span&gt;):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;19&lt;/span&gt;        config&lt;span style="color: #666666"&gt;.&lt;/span&gt;clear()
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;20&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;21&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;def&lt;/span&gt; &lt;span style="color: #0000FF"&gt;test_new_feature&lt;/span&gt;(&lt;span style="color: #008000"&gt;self&lt;/span&gt;):
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;22&lt;/span&gt;        &lt;span style="color: #008000"&gt;self&lt;/span&gt;&lt;span style="color: #666666"&gt;.&lt;/span&gt;assertTrue(our_new_feature())
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In order to understand the behaviour of the existing test, we ran it alone, both with and without the new changes. It appeared that the test was failing in both cases. This gave us the information that this test was using an existing global state, and that we might be cleaning this state. So we took a deeper interest in the &lt;em&gt;tearDown&lt;/em&gt; method.&lt;/p&gt;
&lt;p&gt;It happened that the global configuration was injected and cleared in our new test suite. This configuration was used but rarely cleared in other tests. As a result, the existing test was relying on the execution of the previous ones to succeed. Clearing the configuration removed the context required by the existing test, thus made it fail.&lt;/p&gt;
&lt;p&gt;By “chance” the tests were always run in the right order for years. This situation could have been detected way earlier by using a random execution order for tests. &lt;a href="https://github.com/pytest-dev/pytest-randomly"&gt;It happens that python has simple modules to do so&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To fix the tests and avoid this situation to happen in the future, we decided to force the configuration clearing in the project’s test suite superclass. This meant to fix a bunch of other tests failing after this but also enforced a clean state for all new tests.&lt;/p&gt;
&lt;h4&gt;Bonus story: A good flakiness&lt;/h4&gt;
&lt;p&gt;On top of the previous stories, where flakiness is obviously a bad thing, I also stumbled into a case where I found flakiness somehow beneficial to the codebase.&lt;/p&gt;
&lt;p&gt;In this particular case, the test intended to assert some data consistency for any instances of the same class. To do so, the test was generating numerous instances of the class with randomized inputs.&lt;/p&gt;
&lt;p&gt;This test happened to fail during some executions as the inputs were creating a behaviour not accounted for by the feature. That enabled to extract a specific test case for the input and fix the behaviour in this case.&lt;/p&gt;
&lt;p&gt;While I agree that edge cases should be analyzed during the development process, sometimes the input scope is too wide to consider all of them, let alone test all possibilities.&lt;/p&gt;
&lt;p&gt;In those cases, randomizing the input of a method that should keep a consistent output is a good way to assert the codebase sanity in the long run.&lt;/p&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;This article showed some real-life examples of flaky tests. They were not the worst to track down, but they pinpoint the fact that flakiness can resurface at any time, even years after their introduction!&lt;/p&gt;
&lt;p&gt;Once they appear, the flaky tests need to be fixed as soon as possible out of fear that the failing test suite will be considered as a normal state. The developers may then not rely on the tests suites anymore.&lt;/p&gt;
&lt;p&gt;Flakiness is mostly due to non-deterministic behaviour in the code, in this article we had an example of:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Specific execution time&lt;/em&gt;. If the code is dependent on time, there may be failing tests at specific dates.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Randomness.&lt;/em&gt; Using random values in the main code or in the tests needs extra care or the behaviour may vary depending on those random values.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Modified global state.&lt;/em&gt; Using a global state in a project can create inconsistencies in tests if the state is not managed correctly.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Some behaviour can help to limit the amount of flakiness that hides in the tests, such as:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Control your test execution environment&lt;/em&gt; to keep reproducible execution.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Avoid global states&lt;/em&gt; to minimize the side effects of environment settings.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Randomize the test execution order&lt;/em&gt; to determine dependencies between tests.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Continue on the subject:&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://hackernoon.com/flaky-tests-a-war-that-never-ends-9aa32fdef359"&gt;https://hackernoon.com/flaky-tests-a-war-that-never-ends-9aa32fdef359&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://martinfowler.com/articles/nonDeterminism.html"&gt;https://martinfowler.com/articles/nonDeterminism.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.pytest.org/en/stable/flaky.html"&gt;https://docs.pytest.org/en/stable/flaky.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you are curious about the context that led to the apparition of those flaky tests, my former manager &lt;a href="https://kevin.deldycke.com/"&gt;Kevin Deldycke&lt;/a&gt; provides a more detailed view in a very interesting post: &lt;a href="https://kevin.deldycke.com/2020/10/billing-pipeline-critical-time-sensitive-system/"&gt;&lt;em&gt;Billing Pipeline: A Critical Time Sensitive System&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;</content><category term="Software Engineering"></category><category term="Testing"></category><category term="Best Practice"></category></entry><entry><title>About design patterns: Dependency Injection</title><link href="https://aveuiller.github.io/about_design_patterns-dependency_injection.html" rel="alternate"></link><published>2020-01-05T00:00:00+01:00</published><updated>2020-01-05T00:00:00+01:00</updated><author><name>Antoine Veuiller</name></author><id>tag:aveuiller.github.io,2020-01-05:/about_design_patterns-dependency_injection.html</id><summary type="html">&lt;p&gt;A walk through dependency injection&lt;/p&gt;</summary><content type="html">&lt;h3&gt;Availability Disclaimer&lt;/h3&gt;
&lt;p&gt;This article can be found on other sources:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Medium: &lt;a href="https://medium.com/@aveuiller/about-design-patterns-dependency-injection-ab9c1742d4aa"&gt;Canonical link&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;img alt="credit photo: Bamboo Complexity, taufuuu" src="https://cdn-images-1.medium.com/max/800/1*1WZ618ZBnWNaYy8-XzsX0g.jpeg" /&gt;&lt;/p&gt;
&lt;h3&gt;What is dependency injection?&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;Dependency injection&lt;/em&gt; (DI) is a very simple concept that aims to decouple components of your software and ease their integration and testing. It does so by asking for their sub-components instead of creating them.&lt;/p&gt;
&lt;p&gt;During this article, we will also mention &lt;em&gt;inversion of control&lt;/em&gt; (IoC), which is commonly used along with dependency injection. This pattern aims to avoid asking for implementations but rather interfaces while injecting dependencies.&lt;/p&gt;
&lt;p&gt;This article will use a simple example in Java to present dependency injection but aims towards a technology-agnostic explanation of the concept and its advantages. Moreover, even if it is an object-oriented design pattern, you can still adapt the behaviour in many programming languages.&lt;/p&gt;
&lt;h3&gt;Let’s clarify all this using an example!&lt;/h3&gt;
&lt;p&gt;We will present a weather service that shows an intelligible representation of the weather. In the current implementation, we rely solely on a thermometer.&lt;/p&gt;
&lt;h4&gt;Let’s start without dependency injection.&lt;/h4&gt;
&lt;p&gt;&lt;img alt="Weather service without IoC" src="https://raw.githubusercontent.com/aveuiller/design-tutorials/master/dependencyinjection/specs/classes_without_ioc.svg" /&gt;&lt;/p&gt;
&lt;p&gt;As you can see on the diagram, the &lt;em&gt;WeatherService&lt;/em&gt; is relying on a &lt;em&gt;Thermometer&lt;/em&gt;, which can be configured with a &lt;em&gt;TemperatureUnit&lt;/em&gt;. 
Not using dependency injection will result in a code creating a new instance of &lt;em&gt;Thermometer&lt;/em&gt; in the service, and a &lt;em&gt;Thermometer&lt;/em&gt; configuring the &lt;em&gt;TemperatureUnit&lt;/em&gt; to use:&lt;/p&gt;
&lt;p&gt;&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;Thermometer&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;private&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;final&lt;/span&gt; TemperatureUnit unit;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #0000FF"&gt;Thermometer&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;unit&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; TemperatureUnit.&lt;span style="color: #7D9029"&gt;CELSIUS&lt;/span&gt;;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;  }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;}
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;WeatherService&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;implements&lt;/span&gt; WeatherContract {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;private&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;final&lt;/span&gt; Thermometer thermometer;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;  &lt;span style="color: #408080; font-style: italic"&gt;// This constructor is not using dependency injection&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #0000FF"&gt;WeatherService&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;thermometer&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; Thermometer();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;  }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
Now let’s imagine that we want to use a &lt;em&gt;Thermometer&lt;/em&gt; configured to use Fahrenheit degrees instead of Celsius. For this, we add a parameter to switch between both units.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #0000FF"&gt;Thermometer&lt;/span&gt;(&lt;span style="color: #B00040"&gt;boolean&lt;/span&gt; useCelsius) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;if&lt;/span&gt; (useCelsius) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;unit&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; TemperatureUnit.&lt;span style="color: #7D9029"&gt;CELSIUS&lt;/span&gt;;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;4&lt;/span&gt;  } &lt;span style="color: #008000; font-weight: bold"&gt;else&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;5&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;unit&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; TemperatureUnit.&lt;span style="color: #7D9029"&gt;FAHRENHEIT&lt;/span&gt;;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;6&lt;/span&gt;  }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;7&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;One can also argue that the user of our program won’t always have access to an actual thermometer on their device, thus you may want to be able to fall back to another implementation in this case. 
For instance, an API sending the current temperature in your area. Integrating multiple implementations inside the service could be done as shown below.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #0000FF"&gt;WeatherService&lt;/span&gt;(&lt;span style="color: #B00040"&gt;boolean&lt;/span&gt; useRealDevice, 
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;                      &lt;span style="color: #B00040"&gt;boolean&lt;/span&gt; useCelsius,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;                      String apiKey) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;4&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;if&lt;/span&gt; (useRealDevice) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;5&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;thermometer&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; Thermometer(useCelsius);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;6&lt;/span&gt;  } &lt;span style="color: #008000; font-weight: bold"&gt;else&lt;/span&gt; {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;7&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;thermometer&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; ThermometerWebService(useCelsius, apiKey);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;8&lt;/span&gt;  }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;9&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As a result, initializing the service can be done as follows:&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;static&lt;/span&gt; &lt;span style="color: #B00040"&gt;void&lt;/span&gt; &lt;span style="color: #0000FF"&gt;main&lt;/span&gt;(String&lt;span style="color: #666666"&gt;[]&lt;/span&gt; args) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;  &lt;span style="color: #408080; font-style: italic"&gt;// Not using dependency injection&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;  WeatherContract weather &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; WeatherService(&lt;span style="color: #008000; font-weight: bold"&gt;true&lt;/span&gt;, &lt;span style="color: #008000; font-weight: bold"&gt;true&lt;/span&gt;, &lt;span style="color: #008000; font-weight: bold"&gt;null&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;4&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Even if it is easy to use, our current version of the &lt;em&gt;WeatherService&lt;/em&gt; is not evolutive. If we take a closer look at its constructor, we can see multiple design flaws that will haunt us in the long run:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The constructor is choosing its &lt;em&gt;Thermometer&lt;/em&gt;. Adding a new type of Thermometer would require some parameter tricks to guess the implementation to use.&lt;/li&gt;
&lt;li&gt;The constructor is managing the &lt;em&gt;Thermometer&lt;/em&gt; constructor parameters. Adding the &lt;em&gt;ThermometerWebService&lt;/em&gt; forced us to add a new &lt;em&gt;apiKey&lt;/em&gt; parameter to it, even if unrelated to the &lt;em&gt;WeatherService&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As a result, any change to any &lt;em&gt;Thermometer&lt;/em&gt; implementation may require changes on the &lt;em&gt;WeatherService&lt;/em&gt; constructors. This behaviour is unwanted and breaks the &lt;em&gt;Separation of Concerns&lt;/em&gt; principle.&lt;/p&gt;
&lt;h4&gt;Will dependency injection improve my project?&lt;/h4&gt;
&lt;p&gt;Dependency injection, associated with inversion of control, is a good way to cover this use case. It allows you to choose which kind of thermometer you want in your program depending on the situation. The following diagram gives a quick overview of our new architecture:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Weather service using IoC" src="https://raw.githubusercontent.com/aveuiller/design-tutorials/master/dependencyinjection/specs/classes_using_ioc.svg" /&gt;&lt;/p&gt;
&lt;p&gt;The &lt;strong&gt;inversion of control&lt;/strong&gt; is represented in this diagram by the fact that our &lt;em&gt;WeatherService&lt;/em&gt; implementation is linked to &lt;em&gt;ThermometerContract&lt;/em&gt; rather than any of its implementations. That’s nothing more than this.&lt;/p&gt;
&lt;p&gt;As for &lt;strong&gt;dependency injection&lt;/strong&gt;, &lt;em&gt;WeatherService&lt;/em&gt; will now take a &lt;em&gt;ThermometerContract&lt;/em&gt; in its constructor, requiring the block using the service to build an instance filling this contract:&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;WeatherService&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;implements&lt;/span&gt; WeatherContract {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;  &lt;span style="color: #408080; font-style: italic"&gt;// We now use the Interface   &lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;private&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;final&lt;/span&gt; ThermometerContract thermometer;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;4&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;5&lt;/span&gt;  &lt;span style="color: #408080; font-style: italic"&gt;// New constructor using dependency injection    &lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;6&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #0000FF"&gt;WeatherService&lt;/span&gt;(ThermometerContract thermometer) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;7&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;thermometer&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; thermometer;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;8&lt;/span&gt;  }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;9&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As a result, the initialization of a &lt;em&gt;WeatherService&lt;/em&gt; for both constructors will look like the following:&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;static&lt;/span&gt; &lt;span style="color: #B00040"&gt;void&lt;/span&gt; &lt;span style="color: #0000FF"&gt;main&lt;/span&gt;(String&lt;span style="color: #666666"&gt;[]&lt;/span&gt; args) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;  &lt;span style="color: #408080; font-style: italic"&gt;// Using dependency injection&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;  TemperatureUnit celsius &lt;span style="color: #666666"&gt;=&lt;/span&gt; TemperatureUnit.&lt;span style="color: #7D9029"&gt;CELSIUS&lt;/span&gt;;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;4&lt;/span&gt;  ThermometerContract thermometer &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; Thermometer(celsius);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;5&lt;/span&gt;  WeatherContract weather &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; WeatherService(thermometer);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;6&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, our &lt;em&gt;ThermometerContract&lt;/em&gt; can be fully configured by an external part of the software. More important so, the &lt;em&gt;WeatherService&lt;/em&gt; doesn’t need to know any of the available implementations of &lt;em&gt;ThermometerContract&lt;/em&gt;, thus decoupling your software packages.&lt;/p&gt;
&lt;p&gt;This could seem like nothing important, but this simple switch of responsibility is critical leverage for multiple aspects of software design. It enables you to control the instance creation from your software entry point by chaining dependencies. You won’t have to take care of the instantiation until it is necessary. This behaviour could be compared to raised exceptions, that are ignored until taken care of in a significant context.&lt;/p&gt;
&lt;h3&gt;That’s all there is to dependency injection?&lt;/h3&gt;
&lt;p&gt;It is important to know that even if you can find libraries that help you manage your dependency injection, it is not always necessary to use them.&lt;/p&gt;
&lt;p&gt;Those libraries tend to cover a lot of cases thus be offputting to developers not comfortable with the pattern in the first place. In reality, they simply ease the instantiation of complex dependency trees and are not required at all.&lt;/p&gt;
&lt;p&gt;The following section is an example of injecting our service using &lt;a href="https://github.com/google/guice/wiki"&gt;Guice&lt;/a&gt;, a dependency injection framework for Java made by Google. The concept is to reference bindings of every component you can inject in your program, so that the library can generate a class of any type, automatically.&lt;/p&gt;
&lt;p&gt;Let’s consider that we have two implementations with the following constructors:&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;WeatherService&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;implements&lt;/span&gt; WeatherContract {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;private&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;final&lt;/span&gt; ThermometerContract thermometer;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;  &lt;span style="color: #AA22FF"&gt;@Inject&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #0000FF"&gt;WeatherService&lt;/span&gt;(ThermometerContract thermometer) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;thermometer&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; thermometer;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;  }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;}
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;Thermometer&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;implements&lt;/span&gt; ThermometerContract {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;private&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;final&lt;/span&gt; TemperatureUnit unit;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;  &lt;span style="color: #AA22FF"&gt;@Inject&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #0000FF"&gt;Thermometer&lt;/span&gt;(&lt;span style="color: #AA22FF"&gt;@Named&lt;/span&gt;(WeatherModule.&lt;span style="color: #7D9029"&gt;TEMPERATURE_UNIT&lt;/span&gt;) 
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;                     TemperatureUnit unit) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;    &lt;span style="color: #008000; font-weight: bold"&gt;this&lt;/span&gt;.&lt;span style="color: #7D9029"&gt;unit&lt;/span&gt; &lt;span style="color: #666666"&gt;=&lt;/span&gt; unit;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;  }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;18&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;em&gt;injection module&lt;/em&gt; should be configured to bind all needed interfaces to a given implementation.
It should also be able to inject any object without a specific interface, such as the enumerate &lt;em&gt;TemperatureUnit&lt;/em&gt;. 
The injection will then be bound to a specific name, “&lt;em&gt;temp_unit”&lt;/em&gt; in this case.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;class&lt;/span&gt; &lt;span style="color: #0000FF; font-weight: bold"&gt;WeatherModule&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;extends&lt;/span&gt; AbstractModule {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;static&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;final&lt;/span&gt; String TEMPERATURE_UNIT &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #BA2121"&gt;&amp;quot;temp_unit&amp;quot;&lt;/span&gt;;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;  &lt;span style="color: #AA22FF"&gt;@Override&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;  &lt;span style="color: #008000; font-weight: bold"&gt;protected&lt;/span&gt; &lt;span style="color: #B00040"&gt;void&lt;/span&gt; &lt;span style="color: #0000FF"&gt;configure&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;// Named input configuration bindings&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;    bind(TemperatureUnit.&lt;span style="color: #7D9029"&gt;class&lt;/span&gt;)
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;      .&lt;span style="color: #7D9029"&gt;annotatedWith&lt;/span&gt;(Names.&lt;span style="color: #7D9029"&gt;named&lt;/span&gt;(TEMPERATURE_UNIT))
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;      .&lt;span style="color: #7D9029"&gt;toInstance&lt;/span&gt;(TemperatureUnit.&lt;span style="color: #7D9029"&gt;CELSIUS&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;    &lt;span style="color: #408080; font-style: italic"&gt;// Interface - Implementation bindings&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;    bind(ThermometerContract.&lt;span style="color: #7D9029"&gt;class&lt;/span&gt;).&lt;span style="color: #7D9029"&gt;to&lt;/span&gt;(Thermometer.&lt;span style="color: #7D9029"&gt;class&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;    bind(WeatherContract.&lt;span style="color: #7D9029"&gt;class&lt;/span&gt;).&lt;span style="color: #7D9029"&gt;to&lt;/span&gt;(WeatherService.&lt;span style="color: #7D9029"&gt;class&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;  }
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ultimately, the module can be used as follow, here instantiating a &lt;em&gt;WeatherContract&lt;/em&gt;.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;static&lt;/span&gt; &lt;span style="color: #B00040"&gt;void&lt;/span&gt; &lt;span style="color: #0000FF"&gt;main&lt;/span&gt;(String&lt;span style="color: #666666"&gt;[]&lt;/span&gt; args) {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;2&lt;/span&gt;  &lt;span style="color: #408080; font-style: italic"&gt;// Creating the injection module configured above.&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;3&lt;/span&gt;  Injector injector &lt;span style="color: #666666"&gt;=&lt;/span&gt; Guice.&lt;span style="color: #7D9029"&gt;createInjector&lt;/span&gt;(&lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; WeatherModule());
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;4&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;5&lt;/span&gt;  &lt;span style="color: #408080; font-style: italic"&gt;// We ask for the injection of a WeatherContract, &lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;6&lt;/span&gt;  &lt;span style="color: #408080; font-style: italic"&gt;// which will create an instance of ThermometerContract&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;7&lt;/span&gt;  &lt;span style="color: #408080; font-style: italic"&gt;// with the named TemperatureUnit under the hood.&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;8&lt;/span&gt;  WeatherContract weather &lt;span style="color: #666666"&gt;=&lt;/span&gt; injector.&lt;span style="color: #7D9029"&gt;getInstance&lt;/span&gt;(WeatherContract.&lt;span style="color: #7D9029"&gt;class&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;9&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Such modules usually provide a good power of customization to the injected elements, thus we can consider configuring the injection depending on the available implementations.&lt;/p&gt;
&lt;p&gt;As a result, using a library is not required when integrating dependency injection. However, this could save a lot of time and cumbersome code in big projects.&lt;/p&gt;
&lt;h3&gt;Show me some tests!&lt;/h3&gt;
&lt;p&gt;As a side effect of decoupling your code, the dependency injection pattern is a real asset to improve unit testability of each component. This section contains an example of unit tests for our &lt;em&gt;WeatherService&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;As said above, making &lt;em&gt;WeatherService&lt;/em&gt; asking for a &lt;em&gt;ThermometerContract&lt;/em&gt; enables us to use any implementation we want. Hence, we can send a &lt;em&gt;mock&lt;/em&gt; in the constructor, then control its behaviour from the outside.&lt;/p&gt;
&lt;div class="highlight" style="background: #f8f8f8"&gt;&lt;pre style="line-height: 125%;"&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 1&lt;/span&gt;&lt;span style="color: #008000; font-weight: bold"&gt;public&lt;/span&gt; &lt;span style="color: #B00040"&gt;void&lt;/span&gt; &lt;span style="color: #0000FF"&gt;testTemperatureStatus&lt;/span&gt;() {
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 2&lt;/span&gt;  ThermometerContract thermometer &lt;span style="color: #666666"&gt;=&lt;/span&gt; Mockito.&lt;span style="color: #7D9029"&gt;mock&lt;/span&gt;(ThermometerContract.&lt;span style="color: #7D9029"&gt;class&lt;/span&gt;);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 3&lt;/span&gt;  Mockito.&lt;span style="color: #7D9029"&gt;doReturn&lt;/span&gt;(TemperatureUnit.&lt;span style="color: #7D9029"&gt;CELSIUS&lt;/span&gt;).&lt;span style="color: #7D9029"&gt;when&lt;/span&gt;(thermometer).&lt;span style="color: #7D9029"&gt;getUnit&lt;/span&gt;();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 4&lt;/span&gt;  WeatherContract weather &lt;span style="color: #666666"&gt;=&lt;/span&gt; &lt;span style="color: #008000; font-weight: bold"&gt;new&lt;/span&gt; WeatherService(thermometer);
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 5&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 6&lt;/span&gt;  Mockito.&lt;span style="color: #7D9029"&gt;doReturn&lt;/span&gt;(&lt;span style="color: #666666"&gt;-50&lt;/span&gt;f).&lt;span style="color: #7D9029"&gt;when&lt;/span&gt;(thermometer).&lt;span style="color: #7D9029"&gt;getTemperature&lt;/span&gt;();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 7&lt;/span&gt;  assertEquals(
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 8&lt;/span&gt;    TemperatureStatus.&lt;span style="color: #7D9029"&gt;COLD&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt; 9&lt;/span&gt;    weather.&lt;span style="color: #7D9029"&gt;getTemperatureStatus&lt;/span&gt;()
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;10&lt;/span&gt;  );
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;11&lt;/span&gt;
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;12&lt;/span&gt;  Mockito.&lt;span style="color: #7D9029"&gt;doReturn&lt;/span&gt;(&lt;span style="color: #666666"&gt;10&lt;/span&gt;f).&lt;span style="color: #7D9029"&gt;when&lt;/span&gt;(thermometer).&lt;span style="color: #7D9029"&gt;getTemperature&lt;/span&gt;();
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;13&lt;/span&gt;  assertEquals(
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;14&lt;/span&gt;    TemperatureStatus.&lt;span style="color: #7D9029"&gt;MODERATE&lt;/span&gt;,
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;15&lt;/span&gt;    weather.&lt;span style="color: #7D9029"&gt;getTemperatureStatus&lt;/span&gt;()
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;16&lt;/span&gt;  );
&lt;span style="color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px;"&gt;17&lt;/span&gt;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see, we can then control our thermometer without a struggle from outside our tested class.&lt;/p&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;Dependency injection&lt;/em&gt; is a way of thinking your code architecture and can be simple to implement by yourself. In bigger projects, integrating a dependency injection framework can save you a lot of time in the long run.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Dependency injection&lt;/em&gt; provides multiple non-negligible advantages such as:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;Code decoupling&lt;/em&gt;: use the contracts and ignore implementation specificities.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Enhanced testability&lt;/em&gt;: Unit tests almost become a pleasure to write.&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Configurability&lt;/em&gt;: you can more easily swap injected instances.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://github.com/aveuiller/design-tutorials"&gt;You can find the full code example in my design tutorials repository on GitHub&lt;/a&gt;&lt;/p&gt;</content><category term="Software Engineering"></category><category term="Design Patterns"></category><category term="Dependency Injection"></category><category term="Best Practice"></category></entry></feed>