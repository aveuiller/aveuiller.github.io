<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>    Spring Boot: Apprentice Cookbook
 | Antoine Veuiller</title>

        <meta name="author" content="Antoine Veuiller">
        <meta name="generator" content="Pelican v4.8.0">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" integrity="sha512-oc9+XSs1H243/FRN9Rw62Fn8EtxjEYWHXRvjS43YtueEewbS6ObfXcJNyohjHqVKFPoXXUxwc+q1K7Dee6vv9g==" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css" integrity="sha512-+EoPw+Fiwh6eSeRK7zwIKG2MA8i3rV/DGa3tdttQGgWyatG/SkncT53KHQaS5Jh9MNOT3dmFL0FjTY08And/Cw==" crossorigin="anonymous">

            <link rel="stylesheet" href="https://aveuiller.github.io/theme/css/main.min.css?c73fffa6">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-F9565WT2VE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-F9565WT2VE');
    </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.bundle.min.js" integrity="sha512-iceXjjbmB2rwoX93Ka6HAHP+B76IY1z0o3h+N1PeDtRSsyeetU3/0QKJqGyPJcX63zysNehggFwMC/bi7dvMig==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js" integrity="sha512-IsNh5E3eYy3tr/JiX2Yx4vsCujtkhwl7SLqgnwLNgf04Hrt9BT9SXlLlZlWx+OK4ndzAoALhsMNcCmkggjZB1w==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.2.0/jquery.fitvids.min.js" integrity="sha512-/2sZKAsHDmHNoevKR/xsUKe+Bpf692q4tHNQs9VWWz0ujJ9JBM67iFYbIEdfDV9I2BaodgT5MIg/FTUmUv3oyQ==" crossorigin="anonymous"></script>

            <script src="https://aveuiller.github.io/theme/js/main.min.js?86e1c044"></script>


        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="msapplication-TileColor" content="#ffc40d">
        <meta name="theme-color" content="#ffffff">

        <!-- Feeds -->
            <link href="https://aveuiller.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Antoine Veuiller - All posts - Atom Feed">
            <link href="https://aveuiller.github.io/feeds/software-engineering.atom.xml" type="application/atom+xml" rel="alternate" title="Antoine Veuiller - Category: Software Engineering - Atom Feed">

        <meta name="keywords" content="Cheat sheet, Java, Spring Boot">

    </head>

    <body class="bg-transparent pt-4">

        <div class="container">

                <a href="https://aveuiller.github.io" class="avatar-container float-left mx-4">
                    <div class="avatar ">
                        <div class="side"><img src="/images/profile.jpg" class="img-fluid"></div>
                    </div>
                </a>

            <h1>
                <a href="https://aveuiller.github.io" class="text-dark text-decoration-none">Antoine Veuiller</a>
                <small class="text-secondary"><small></small></small>
            </h1>

            <nav class="navbar d-block navbar-expand-lg navbar-light bg-light shadow rounded-lg">

                <a class="navbar-brand d-none" href="https://aveuiller.github.io" title="">Antoine Veuiller</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#plumage-navbar-collapse-1" aria-controls="plumage-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="plumage-navbar-collapse-1">

                    <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
<li class="nav-item ">
                                    <a class="nav-link" href="https://aveuiller.github.io/pages/about-me.html">
                                        About Me
                                    </a>
                                </li>
<li class="nav-item ">
                                    <a class="nav-link" href="https://aveuiller.github.io/pages/collaborations.html">
                                        Collaborations
                                    </a>
                                </li>
<li class="nav-item ">
                                    <a class="nav-link" href="https://aveuiller.github.io/category/around-computer-science.html">
                                        Around Computer Science
                                    </a>
                                </li>
<li class="nav-item ">
                                    <a class="nav-link" href="https://aveuiller.github.io/category/software-engineering.html">
                                        Software Engineering
<span class="sr-only">(current)</span>                                    </a>
                                </li>
                    </ul>


                </div>

            </nav>

        </div>


        <div class="container mt-5">


            <div class="row">
                <div class="
                        col-md-9
">
    <h1>
        <a href="https://aveuiller.github.io/spring_boot_apprentice_cookbook.html" rel="bookmark" title="Permalink to Spring Boot: Apprentice Cookbook">Spring Boot: Apprentice Cookbook</a>
    </h1>
                </div>
            </div>

            <div class="row">


                <div id="content" role="main" class="
                        col-md-9
">
    

    <h3>Availability Disclaimer</h3>
<p>This article can be found on other sources:</p>
<ul>
<li>Medium: <a href="https://medium.com/@aveuiller/spring-boot-apprentice-cookbook-61db5a3f6450">link</a></li>
</ul>
<hr>
<p><img alt="Spring Boot logo" src="https://cdn-images-1.medium.com/max/800/1*gxXLMIuJDHCH7fwIgEP1cg.png" class="img-fluid border rounded shadow"></p>
<p><a href="https://spring.io/projects/spring-boot">Spring Boot</a> is a web framework built on top of the framework <a href="https://spring.io/projects/spring-framework">Spring</a>. It is designed for easier use and quicker implementation. It does so by configuring the application and its environment as automatically as possible. As a newcomer, I can say that it makes the framework really easy to get into.</p>
<p>My learning led me to read most of the <a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#using-boot-structuring-your-code">reference documentation</a>, which is well written and gives you a lot of insights into the internal behavior of Spring Boot. This documentation gives a lot of details, so this article aims to take the counter approach and pinpoint the concepts you will need to implement an API using Spring Boot. I will complement each section with a set of links to related documentation, may you want to dig further.</p>
<p>As a side note, this document will be using version 2.4.2 of the framework, on a Java project using Gradle as the build system. 
However, the information remains applicable to any compatible language and build system.</p>
<p>This article will cover the following aspects of creating an API with Spring Boot:</p>
<ul>
<li>Bootstrap the project</li>
<li>Create REST endpoints</li>
<li>Handle errors</li>
<li>Connect to a persistence layer</li>
<li>Paginate the results</li>
<li>Test the application</li>
<li>Package the Application</li>
</ul>
<h3>Bootstrap the project</h3>
<p>This part may be the easiest, as Spring Boot is providing a package generator at <a href="https://start.spring.io/">https://start.spring.io/</a>. We can select all required modules and retrieve an archived project with the build system, dependencies, and main application class.</p>
<p>Outside of this generator, to declare a RESTful API, our project should define the Spring Boot <em>starter web</em> dependency. 
The <em>starter</em> dependencies are a set of ready to use features packaged by Spring Boot.</p>
<p>```groovy
plugins {
  id 'org.springframework.boot' version '2.4.2'
}</p>
<p>dependencies {
  implementation 'org.springframework.boot:spring-boot-starter-web'
}
```</p>
<p>The application’s main method should be contained in any class, on which we should apply the annotation <code>@SpringBootApplication</code>. This annotation is responsible for a lot of automatic configurations, namely the components injection and web server startup.</p>
<p><code>java
@SpringBootApplication
public class MyApplication {
    public static void main(String[] args) {
        SpringApplication.run(MyApplication.class, args);
    }
}</code></p>
<p>Starting the server is as simple as using the embedded command <code>./gradlew bootRun</code>. 
The server will start, but we don’t have any endpoint to serve at the moment.</p>
<blockquote class="blockquote border-left border-primary pl-3">
<p>Documentation links:</p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#using-boot-using-springbootapplication-annotation">@SpringBootApplication</a></p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#using-boot-starter">List of starter dependencies</a></p>
</blockquote>
<h3>Create a REST endpoint</h3>
<p>To create a controller, we simply have to annotate any class with <code>@RestController</code>.
We can then configure any method inside this controller as an endpoint using <code>@RequestMapping</code>.</p>
<p><code>@RequestMapping</code> help us configuring the endpoint by providing an URL, the HTTP verb, the expected data type, and more. 
It can be applied both on a class and a method, the configurations applied on the class will be inherited by the methods underneath and the path concatenated.</p>
<p>To control our endpoint status codes we will return a<code>ResponseEntity</code>, holding both the response message and <code>HttpStatus</code>.</p>
<p>```java
@RestController
@RequestMapping(value = "/hello",
        consumes = MediaType.ALL_VALUE,
        produces = MediaType.APPLICATION_JSON_VALUE)
public class HelloWorldController {</p>
<p>@RequestMapping(value = "/world", method = RequestMethod.GET)
    public ResponseEntity<map string>&gt; index() {
        HashMap<string string> output = new HashMap&lt;&gt;();
        output.put("message", "Hello World!");
        return new ResponseEntity&lt;&gt;(output, HttpStatus.OK);
    }
}
```</string></map></p>
<p>The <code>ResponseEntity</code> will be automatically transformed to an HTTP response, using the <code>HttpStatus</code> as response code and transforming the message to a JSON object.
On top of transforming <em>Maps</em> to JSON objects, Spring Boot configure <a href="https://github.com/FasterXML/jackson">Jackson</a> to map all <code>public</code> attributes or getters of any class to a JSON object.</p>
<p><code>shell
$ curl -i "localhost:8080/hello/world"
HTTP/1.1 200
{"Hello":"World"}</code></p>
<blockquote class="blockquote border-left border-primary pl-3">
<p>Documentation links:</p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#getting-started-first-application-annotations">@RestController and @RequestMapping</a></p>
<p><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/RequestMapping.html">@RequestMapping API doc</a></p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#howto-customize-the-jackson-objectmapper">Customize Json Serialization</a></p>
</blockquote>
<h3>Advanced endpoint configuration</h3>
<p>Now that we have a controller, we may want to define dynamic HTTP endpoints. To do so, the main annotations to keep in mind are:</p>
<ul>
<li><code>@RequestBody</code> : Defines a body structure through a java Class.</li>
<li><code>@PathVariable</code>: Defines a variable subpart of the endpoint URL.</li>
<li><code>@RequestParam</code> : Defines a query parameter.</li>
</ul>
<p>The controller below showcases the three annotations with two endpoints, each returning a custom “Hello World” depending on the query.</p>
<p>````java
@RestController
@RequestMapping(value = "/hello",
        consumes = MediaType.ALL_VALUE,
        produces = MediaType.APPLICATION_JSON_VALUE)
public class HelloWorldController {</p>
<p>// The behavior is not representative of a typical POST request
    // and only here as a matter of example.
    @RequestMapping(value = "", method = RequestMethod.POST)
    public ResponseEntity<map string>&gt; greetFromBody(@RequestBody HelloBody helloBody) {
        HashMap<string string> output = new HashMap&lt;&gt;();
        output.put("message", "Hello " + helloBody.getName());
        return new ResponseEntity&lt;&gt;(output, HttpStatus.OK);
    }</string></map></p>
<p>@RequestMapping(value = "/{name}", method = RequestMethod.GET)
    public ResponseEntity<map string>&gt; greet(@PathVariable String name,
                                                     @RequestParam(required = false,
                                                                   defaultValue = "0") int amount_exclamation) {
        HashMap<string string> output = new HashMap&lt;&gt;();
        StringBuilder b = new StringBuilder("Hello ");
        b.append(name);
        for (int i = 0; i &lt; amount_exclamation; i++) {
            b.append("!");
        }
        output.put("message", b.toString());
        return new ResponseEntity&lt;&gt;(output, HttpStatus.OK);
    }
}</string></map></p>
<p>class HelloBody {
    String name;</p>
<p>public HelloBody() {
        // Used by Jackson
    }</p>
<p>public String getName() {
        return this.name;
    }
}
````</p>
<p>The endpoints defined above can be used as follows:</p>
<p _message_:_hello='"message":"Hello' jack_='jack!!!!"'>```shell
curl -i "localhost:8080/hello/jack?amount_exclamation=4"
HTTP/1.1 200</p>
<h1>-d automatically creates a POST request.</h1>
<p>$ curl -i "localhost:8080/hello" -d '{"name": "Bob"}' -H "Content-Type: application/json"
HTTP/1.1 200
{"message":"Hello Bob"}
```</p>
<blockquote class="blockquote border-left border-primary pl-3">
<p>Documentation links:</p>
<p><a href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/spring-framework-reference/web.html#mvc-ann-requestbody">@RequestBody</a></p>
<p><a href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/spring-framework-reference/web.html#mvc-ann-requestmapping-uri-templates">@PathVariable</a></p>
<p><a href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/spring-framework-reference/web.html#mvc-ann-requestparam">@RequestParam</a></p>
</blockquote>
<h3>Handle errors</h3>
<p>By default, Spring Boot will return the HTTP code 200 for any successful request, 404 if the endpoint is not registered, and 500 for any error. We already saw that using <code>ResponseEntity</code> enables us to override this behavior for successful requests, but we still need to handle error codes more finely.</p>
<p>To do so, we will define custom API exceptions that will be automatically transformed into HTTP codes. 
This transformation is done by a class extending <code>ResponseEntityExceptionHandler</code> and annotated with <code>@ControllerAdvice</code>. 
In this class, we can define methods to handle exceptions using the annotations <code>@ExceptionHandler</code> and <code>@ResponseStatus</code>.</p>
<p>```java
@ControllerAdvice
public class MyApplicationControllerAdvice extends ResponseEntityExceptionHandler {</p>
<p>@ExceptionHandler(ApiException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public void handleBadRequest() {
    }</p>
<p>@ExceptionHandler(NotFoundException.class)
    @ResponseStatus(HttpStatus.NOT_FOUND)
    public void handleNotFound() {
    }
}</p>
<p>public class ApiException extends Exception {
}</p>
<p>public class NotFoundException extends ApiException {
}
```</p>
<p>After defining the <code>ControllerAdvice</code> in your project, any exception thrown by your controllers will be parsed and transformed to the bound <code>ResponseStatus</code>.</p>
<p>```java
@RestController
@RequestMapping(value = "/exception")
public class ExceptionController {</p>
<p>@RequestMapping(value = "/404", method = RequestMethod.GET)
    public ResponseEntity<map string>&gt; notFound() throws NotFoundException {
        throw new NotFoundException();
    }    </map></p>
<p>@RequestMapping(value = "/400", method = RequestMethod.GET)
    public ResponseEntity<map string>&gt; badRequest() throws ApiException {
        throw new ApiException();
    }</map></p>
<p>@RequestMapping(value = "/500", method = RequestMethod.GET)
    public ResponseEntity<map string>&gt; ise() throws Exception {
        throw new Exception();
    }
}
```</map></p>
<p>```shell
$ curl -i "localhost:8080/exception/500"
HTTP/1.1 500</p>
<p>$ curl -i "localhost:8080/exception/404"
HTTP/1.1 404</p>
<p>$ curl -i "localhost:8080/exception/400"
HTTP/1.1 400
```</p>
<p>Our exception handling is very simple and does not return any payload, but it is possible to implement exception parsing in the methods of <code>ResponseEntityExceptionHandler</code>.</p>
<blockquote class="blockquote border-left border-primary pl-3">
<p>Documentation links:</p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-error-handling">ResponseEntityExceptionHandler</a></p>
<p><a href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/spring-framework-reference/web.html#mvc-ann-controller-advice">@ControllerAdvice</a></p>
<p><a href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/spring-framework-reference/web.html#mvc-ann-exceptionhandler">@ExceptionHandler</a></p>
<p><a href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/spring-framework-reference/web.html#mvc-ann-exceptionhandler-return-values">@ResponseStatus</a></p>
</blockquote>
<h3>Connect to a persistence layer</h3>
<h4>Configuration</h4>
<p>To use a database, we will need the <em>Java Persistence API</em> (JPA) package and the implementation of any persistence layer.
The former will install interface APIs, while the latter will provide the implementations and drivers.</p>
<p>To pinpoint the minimal changes required to switch between two distinct databases, we will show the integration with both <a href="https://www.postgresql.org/">PostgreSQL</a> and <a href="https://www.h2database.com/html/main.html">H2</a> at the same time.
First, let’s declare our dependencies:</p>
<p>```groovy
dependencies {
  implementation 'org.springframework.boot:spring-boot-starter-data-jpa'</p>
<p>// Dependencies to your used dbms
  implementation 'org.postgresql:postgresql:42.2.1'
  implementation 'com.h2database:h2:1.4.200'
}
```</p>
<p>The second step is to configure the accesses in <code>application.properties</code>. The property file is the first and the last time we will have to worry about our persistence configuration. In this file, the 3 lines commented out are the only part to change to switch from PostgreSQL to H2.</p>
<p>```properties
spring.datasource.username=user
spring.datasource.password=password
spring.datasource.generate-unique-name=true</p>
<h1>Automatically create &amp; update the database schema from code.</h1>
<p>spring.jpa.hibernate.ddl-auto=update</p>
<h1>spring.datasource.url=jdbc:h2:mem:database_name</h1>
<p>spring.datasource.url=jdbc:postgresql://localhost:5432/database_name</p>
<h1>spring.datasource.driver-class-name=org.h2.Driver</h1>
<p>spring.datasource.driver-class-name=org.postgresql.Driver</p>
<h1>spring.jpa.database-platform=org.hibernate.dialect.H2Dialect</h1>
<p>spring.jpa.database-platform=org.hibernate.dialect.PostgreSQL10Dialect
```</p>
<blockquote class="blockquote border-left border-primary pl-3">
<p>Documentation links:</p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-configure-datasource">Database configuration</a></p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#data-properties">Available properties</a></p>
</blockquote>
<h4>Define a model</h4>
<p>Defining a model is as simple as using annotations defined on <a href="https://www.jcp.org/en/jsr/detail?id=317">JSR-317</a>. These annotations are available through the package <em>javax.persistence,</em> which is available through the JPA dependency.</p>
<p>For instance, the code below creates a <em>Delivery</em> entity. Our entity identifier is the field <em>id</em>, which will be automatically initialized and increased on each new saved entity in the database thanks to the annotation <code>@GeneratedValue</code>.</p>
<p><em>Note: All attributes publicly available will be set into the JSON representation of the entity in the API responses.</em></p>
<p>```java
@Entity
@Table(name = "delivery")
public class Delivery {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    long id;</p>
<p>@Column(nullable = false)
    @NotNull
    @Enumerated(EnumType.STRING)
    DeliveryState state;</p>
<p>@Column(nullable = false)
    @NotNull
    String location;</p>
<p>public Delivery() {
        // Used by Jackson2
    }</p>
<p>public Delivery(@NotNull DeliveryState state, @NotNull String location) {
        this.state = state;
        this.location = location;
    }</p>
<p>public long getId() {
        return id;
    }</p>
<p>public DeliveryState getState() {
        return state;
    }</p>
<p>public void setState(DeliveryState state) {
        this.state = state;
    }</p>
<p>public String getLocation() {
        return location;
    }</p>
<p>public void setLocation(String location) {
        this.location = location;
    }
}</p>
<p>enum DeliveryState {
    PENDING, DELIVERING, WAITING_AT_ARRIVAL, RETURNING, RETURNED, PICKED_UP;
}
```</p>
<p>To ensure consistency of our data class, we applied <code>@NotNull</code> validations from <a href="https://jcp.org/en/jsr/detail?id=303">JSR-303</a>, these validations can be enforced on endpoints as we will see during the next section. 
The constraints are contained in the package <em>javax.validation.constraints</em>, available through the dependency <code>spring-boot-starter-validation</code>.</p>
<p><code>groovy
dependencies {
  implementation 'org.springframework.boot:spring-boot-starter-validation'
}</code></p>
<blockquote class="blockquote border-left border-primary pl-3">
<p>Documentation links:</p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-entity-classes">Entity Declaration</a></p>
<p><a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/package-summary.html">javax.persistence API documentation (@Entity, @Column, @Enumerate, …)</a></p>
<p><a href="https://javaee.github.io/javaee-spec/javadocs/javax/persistence/GeneratedValue.html">@GeneratedValue</a></p>
<p><a href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/constraints/package-summary.html">javax.validation.constraints API documentation (@NotNull)</a></p>
</blockquote>
<h4>Expose the model</h4>
<p>To interact with our models, we have to define a <a href="https://docs.spring.io/spring-data/commons/docs/2.4.2/api/org/springframework/data/repository/Repository.html">Repository</a>, for instance, a <code>CrudRepository</code>.
Doing so is as easy as extending the class with an empty class. Spring Boot will automatically implement functions to interact with the entity.</p>
<p><code>java
@Repository
public interface DeliveryRepository extends CrudRepository&lt;Delivery, Long&gt; {
}</code></p>
<p>We annotate this component <code>@Repository</code> to make it available to dependency injection. 
Then we can inject and use the repository in any class, for example directly in a controller. 
Using<code>@Autowired</code> will automatically retrieve the <code>@Repository</code> declared above_._</p>
<p><em>Note:</em> <code>_@Repository_</code> <em>and</em> <code>_@Service_</code> <em>behave exactly as the main injection annotation</em><code>_@Component_</code><em>, it simply enables to mark a semantic difference.</em></p>
<p>```java
@RestController
@RequestMapping(value = "/delivery",
        consumes = MediaType.APPLICATION_JSON_VALUE,
        produces = MediaType.APPLICATION_JSON_VALUE)
public class DeliveryController {</p>
<p>private final DeliveryRepository deliveryRepository;</p>
<p>@Autowired
    public DeliveryController(DeliveryRepository deliveryRepository) {
        this.deliveryRepository = deliveryRepository;
    }</p>
<p>@RequestMapping(value = "", method = RequestMethod.POST)
    public ResponseEntity<delivery> post(@Valid @RequestBody Delivery delivery) throws ApiException {
        try {
            delivery = deliveryRepository.save(delivery);
        } catch (Exception e) {
            throw new ApiException();
        }
        return new ResponseEntity&lt;&gt;(delivery, HttpStatus.OK);
    }</delivery></p>
<p>@RequestMapping(value = "/{id}", method = RequestMethod.GET)
    public ResponseEntity<delivery> get(@PathVariable long id) throws ApiException {
        Optional<delivery> delivery = deliveryRepository.findById(id);
        if (delivery.isEmpty()) {
            throw new NotFoundException();
        }
        return new ResponseEntity&lt;&gt;(delivery.get(), HttpStatus.OK);
    }
}
```</delivery></delivery></p>
<p>We used the annotation<code>@Valid</code> to ensure that our constraints defined above are met on the sent <em>Delivery</em> body.</p>
<p>```shell
$ curl -i "localhost:8080/delivery" -H 'Content-Type: application/json' \
  -X POST -d '{"state": "PENDING"}'                <br>
HTTP/1.1 400 </p>
<p>$ curl -i "localhost:8080/delivery/1" -H 'Content-Type: application/json'
HTTP/1.1 404 </p>
<p _id_:1_state_:_pending_location_:_budapest_='"id":1,"state":"PENDING","location":"Budapest"'>$ curl -i "localhost:8080/delivery" -H 'Content-Type: application/json' \
  -X POST -d '{"state": "PENDING", "location":"Budapest"}'
HTTP/1.1 200 </p>
<p>$ curl -i "localhost:8080/delivery/1" -H 'Content-Type: application/json'                                                                                 130 ↵
HTTP/1.1 200
{"id":1,"state":"PENDING","location":"Budapest"}
```</p>
<p><em>Note: H2 is an in-memory database so the data will be wiped out at each server restart.</em></p>
<blockquote class="blockquote border-left border-primary pl-3">
<p>Documentation Links:</p>
<p><a href="https://docs.spring.io/spring-data/commons/docs/2.4.2/api/org/springframework/data/repository/CrudRepository.html">CrudRepository API Documentation</a></p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#using-boot-spring-beans-and-dependency-injection">Spring Component Declaration</a></p>
<p><a href="https://javaee.github.io/javaee-spec/javadocs/javax/validation/package-summary.html">javax.validation API documentation (@Valid)</a></p>
</blockquote>
<h3>Paginate the results</h3>
<p>This section illustrates how well Spring Boot integrates some classic features of a web API. 
To paginate the access to our previous entity <em>Delivery,</em> we simply have to change the repository’s extended class from <code>CrudRepository</code> to <code>PagingAndSortingRepository</code>.</p>
<p><code>java
@Repository
public interface DeliveryRepository extends PagingAndSortingRepository&lt;Delivery, Long&gt; {
}</code></p>
<p>This repository implementation provides a new method <code>findAll(Pageable)</code> returning a <code>Page</code>. 
The class <code>Pageable</code> configures the page and page size to return.</p>
<p>```java
@RestController
@RequestMapping(value = "/delivery",
        consumes = MediaType.APPLICATION_JSON_VALUE,
        produces = MediaType.APPLICATION_JSON_VALUE)
public class DeliveryController {</p>
<p>private final DeliveryRepository deliveryRepository;</p>
<p>@Autowired
    public DeliveryController(DeliveryRepository deliveryRepository) {
        this.deliveryRepository = deliveryRepository;
    }</p>
<p>@RequestMapping(value = "", method = RequestMethod.GET)
    public ResponseEntity<page>&gt; index(@RequestParam(required = false, defaultValue = "0") int page) {
        Pageable pageable = PageRequest.of(page, 50);
        return new ResponseEntity&lt;&gt;(deliveryRepository.findAll(pageable), HttpStatus.OK);
    }
}
```</page></p>
<p>The endpoint will then serve the whole <code>Page</code> object’s data upon request.</p>
<p><code>shell
$ curl "localhost:8080/delivery" -H 'Content-Type: application/json' | jq                                                                                   4 ↵
{
  "content": [
    {
      "id": 1,
      "state": "PENDING",
      "location": "Budapest"
    }
  ],
  "pageable": {
    "sort": {
      "sorted": false,
      "unsorted": true,
      "empty": true
    },
    "offset": 0,
    "pageNumber": 0,
    "pageSize": 50,
    "paged": true,
    "unpaged": false
  },
  "totalPages": 1,
  "totalElements": 1,
  "last": true,
  "first": true,
  "size": 50,
  "number": 0,
  "sort": {
    "sorted": false,
    "unsorted": true,
    "empty": true
  },
  "numberOfElements": 1,
  "empty": false
}</code></p>
<blockquote class="blockquote border-left border-primary pl-3">
<p>Documentation links:</p>
<p><a href="https://docs.spring.io/spring-data/commons/docs/2.4.2/api/org/springframework/data/repository/PagingAndSortingRepository.html">PagingAndSortingRepository API Documentation</a></p>
<p><a href="https://docs.spring.io/spring-data/commons/docs/2.4.2/api/org/springframework/data/domain/PageRequest.html">PageRequest API Documentation</a></p>
<p><a href="https://docs.spring.io/spring-data/commons/docs/2.4.2/api/org/springframework/data/domain/Page.html">Page API Documentation</a></p>
</blockquote>
<h3>Test the application</h3>
<p>Spring Boot provides every tool to easily test controllers with a set of APIs and <a href="https://en.wikipedia.org/wiki/Mock_object">mocks</a>. 
Mostly, <code>MockMvc</code> will enable us to send requests and assert response content without having to worry about technicalities.</p>
<p>As an example, we are testing the <em>POST</em> endpoint from the section above. One of these tests is successfully creating a <em>Delivery</em> entity, and the second one simulates an error coming from the database.</p>
<p>To avoid relying on a physical instance of a persistence layer, we injected our DeliveryRepository instance using <code>@MockBean</code>, which creates and injects a mock of our component.</p>
<p>```java
@SpringBootTest
@AutoConfigureMockMvc
class DeliveryControllerTest {
    @Autowired
    private MockMvc mvc;</p>
<p>@MockBean
    DeliveryRepository deliveryRepository;</p>
<p>@Test
    void testPostDeliveryOk() throws Exception {
        ObjectMapper mapper = new ObjectMapper();
        Map<string string> delivery = getValidDelivery();
        String body = mapper.writeValueAsString(delivery);
        MockHttpServletRequestBuilder accept =
                MockMvcRequestBuilders.post("/delivery")
                        .accept(MediaType.APPLICATION_JSON)
                        .contentType(MediaType.APPLICATION_JSON)
                        .content(body);
        mvc.perform(accept).andExpect(status().isOk());
    }</string></p>
<p>@Test
    void testPostPersistIssue() throws Exception {
        ObjectMapper mapper = new ObjectMapper();
        Map<string string> delivery = getValidDelivery();
        String body = mapper.writeValueAsString(delivery);
        Mockito.when(deliveryRepository.save(Mockito.any())).thenThrow(new RuntimeException());</string></p>
<p>MockHttpServletRequestBuilder accept =
                MockMvcRequestBuilders.post("/delivery")
                        .accept(MediaType.APPLICATION_JSON)
                        .contentType(MediaType.APPLICATION_JSON)
                        .content(body);</p>
<p>mvc.perform(accept).andExpect(status().is4xxClientError());
    }</p>
<p>private Map<string string> getValidDelivery() {
        Map<string string> delivery = new HashMap&lt;&gt;();
        delivery.put("state", "PENDING");
        delivery.put("location", "Rome");
        return delivery;
    }
}
```</string></string></p>
<blockquote class="blockquote border-left border-primary pl-3">
<p>Documentation links:</p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-testing-spring-boot-applications">@SpringBootTest</a></p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-with-mock-environment">@AutoConfiguredMockMvc</a></p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-testing-spring-boot-applications-mocking-beans">@MockBean</a></p>
<p><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/web/servlet/MockMvc.html">MockMvc api Documentation</a></p>
</blockquote>
<h3>Package the application</h3>
<p>Spring boot also eases the application packaging either as a standalone jar or a docker image.</p>
<ul>
<li>To create a ready to run <em>fat jar</em>, execute <code>./gradlew bootJar</code>.</li>
<li>To build a <em>docker image</em>, execute <code>./gradlew bootBuildImage</code>.</li>
</ul>
<p>Note that docker does not like uppercase characters in the image name, but we can easily customize the image name and version.</p>
<p><code>groovy
// Only use lowercase on docker image name
tasks.named("bootBuildImage") {
    imageName = "${rootProject.name.toLowerCase()}:${version}"
}</code></p>
<blockquote class="blockquote border-left border-primary pl-3">
<p>Documentation links:</p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#getting-started-first-application-executable-jar">Create an application fat jar</a></p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.4.2/reference/htmlsingle/#boot-features-container-images">Configure Docker Image</a></p>
</blockquote>
<h3>Conclusion</h3>
<p>Spring Boot can be used with a handful of annotations and will manage most of the configuration for you. 
However, most of the configuration can be overridden to provide your own behavior if necessary. 
This makes it a good framework to design proof of concepts while keeping room for optimization if the project grows specific needs.</p>
<p>If you want to know more about the framework, I can’t stress enough the quality of the <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/">Reference Documentation</a>, which gives really good details.</p>
<p>If you want to play around with some code, you can find all those concepts on an example delivery API <a href="https://github.com/aveuiller/frameworks-bootstrap/tree/master/SpringBoot">on GitHub</a>.</p>



                </div>

                    <div class="col-md-3">
    <div class="card bg-light text-dark">
        <ul class="list-group list-group-flush">

            <li class="list-group-item">
                <abbr title="2021-01-27T00:00:00+01:00"><i class="fas fa-calendar"></i> mer. 27 janvier 2021</abbr>
            </li>

                <li class="list-group-item">
                    <address>
                        <i class="fas fa-user"></i> By
                            <a href="https://aveuiller.github.io/author/antoine-veuiller.html" rel="author">Antoine Veuiller</a>
                    </address>
                </li>

                <li class="list-group-item">
                                <a href="https://aveuiller.github.io/category/software-engineering.html" rel="tag" data-toggle="tooltip" class="badge badge-info" title="6 articles in this category">Software Engineering</a>
                            <a href="/tag/cheat-sheet.html" data-toggle="tooltip" class="badge badge-secondary" title="3 articles with this tag">Cheat sheet</a>
                            <a href="/tag/java.html" data-toggle="tooltip" class="badge badge-secondary" title="1 article with this tag">Java</a>
                            <a href="/tag/spring-boot.html" data-toggle="tooltip" class="badge badge-secondary" title="1 article with this tag">Spring Boot</a>
                </li>



        </ul>
    </div>
                        
                    </div>

            </div>

        </div>

        <footer class="container-fluid mt-5 p-4 small">
            <div class="row mx-5">

                    <div class="col-md-2">
                            <h6>Social</h6>
                            <ul class="list-unstyled">
                                        <li><a href="http://twitter.com/AVeuiller">
        <i class="fab fa-twitter fa-fw"></i>
    Twitter
</a></li>
                                        <li><a href="https://stackoverflow.com/users/2564085/aveuiller">
        <i class="fab fa-stack-overflow fa-fw"></i>
    StackOverflow
</a></li>
                                        <li><a href="http://github.com/aveuiller">
        <i class="fab fa-github fa-fw"></i>
    GitHub
</a></li>
                                        <li><a href="https://aveuiller.medium.com/">
        <img src="https://www.google.com/s2/favicons?domain=aveuiller.medium.com" width="16" height="16" class="link-icon" alt="aveuiller.medium.com icon">
    Medium
</a></li>
                                        <li><a href="https://dev.to/aveuiller/">
        <img src="https://www.google.com/s2/favicons?domain=dev.to" width="16" height="16" class="link-icon" alt="dev.to icon">
    Dev.to
</a></li>
                            </ul>
                    </div>
                    <div class="col-md-2">
                    </div>

                <div class="col-md-2">
                    <h6>Browse content by</h6>
                    <ul class="list-unstyled">
                    </ul>
                </div>

                <div class="col-md-2 text-muted">
                    <h6>Copyright notice</h6>
                    <p class="small">
                        © Copyright
                        2020-2022
                        Antoine Veuiller.
                    </p>
                </div>

                <div class="col-md-2 text-muted">
                    <h6>Disclaimer</h6>
                    <p class="small">
                            All opinions expressed in this site are my own
                            personal opinions and are not endorsed by, nor
                            do they represent the opinions of my previous,
                            current and future employers or any of its
                            affiliates, partners or customers.
                    </p>
                </div>

                <div class="col-md-2">
                        <h6>Feeds</h6>
                        <ul class="list-unstyled small">
                                <li>
                                    <a href="https://aveuiller.github.io/feeds/all.atom.xml">
                                        <i class="fas fa-atom fa-fw"></i> All posts (Atom)
                                    </a>
                                </li>
                                <li>
                                    <a href="https://aveuiller.github.io/feeds/software-engineering.atom.xml">
                                        <i class="fas fa-atom fa-fw"></i> Category: Software Engineering (Atom)
                                    </a>
                                </li>
                        </ul>
                </div>

            </div>
            <div class="row mt-3">

                <div class="offset-3 col-6 small text-muted text-center">
                    Site generated by <a class="text-dark" href="https://getpelican.com">Pelican</a>.<br>
                    <a class="text-dark" href="https://github.com/kdeldycke/plumage">Plumage</a>
                    theme by <a class="text-dark" href="https://kevin.deldycke.com">Kevin Deldycke</a>.
                </div>

                <div class="col-3 text-right d-flex flex-column">
                    <a class="mt-auto" href="#"><i class="fas fa-arrow-up"></i> Back to top</a>
                </div>

            </div>
        </footer>

    </body>
</html>