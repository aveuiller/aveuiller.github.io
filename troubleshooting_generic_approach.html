<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>    A Generic Approach to Troubleshooting
 | Antoine Veuiller</title>

        <meta name="author" content="Antoine Veuiller">
        <meta name="generator" content="Pelican v4.8.0">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/css/bootstrap.min.css" integrity="sha512-oc9+XSs1H243/FRN9Rw62Fn8EtxjEYWHXRvjS43YtueEewbS6ObfXcJNyohjHqVKFPoXXUxwc+q1K7Dee6vv9g==" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css" integrity="sha512-+EoPw+Fiwh6eSeRK7zwIKG2MA8i3rV/DGa3tdttQGgWyatG/SkncT53KHQaS5Jh9MNOT3dmFL0FjTY08And/Cw==" crossorigin="anonymous">

            <link rel="stylesheet" href="https://aveuiller.github.io/theme/css/main.min.css?c73fffa6">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-F9565WT2VE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-F9565WT2VE');
    </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.3/js/bootstrap.bundle.min.js" integrity="sha512-iceXjjbmB2rwoX93Ka6HAHP+B76IY1z0o3h+N1PeDtRSsyeetU3/0QKJqGyPJcX63zysNehggFwMC/bi7dvMig==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js" integrity="sha512-IsNh5E3eYy3tr/JiX2Yx4vsCujtkhwl7SLqgnwLNgf04Hrt9BT9SXlLlZlWx+OK4ndzAoALhsMNcCmkggjZB1w==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.2.0/jquery.fitvids.min.js" integrity="sha512-/2sZKAsHDmHNoevKR/xsUKe+Bpf692q4tHNQs9VWWz0ujJ9JBM67iFYbIEdfDV9I2BaodgT5MIg/FTUmUv3oyQ==" crossorigin="anonymous"></script>

            <script src="https://aveuiller.github.io/theme/js/main.min.js?86e1c044"></script>


        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="msapplication-TileColor" content="#ffc40d">
        <meta name="theme-color" content="#ffffff">

        <!-- Feeds -->
            <link href="https://aveuiller.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Antoine Veuiller - All posts - Atom Feed">
            <link href="https://aveuiller.github.io/feeds/software-engineering.atom.xml" type="application/atom+xml" rel="alternate" title="Antoine Veuiller - Category: Software Engineering - Atom Feed">

        <meta name="keywords" content="Best Practice, System Engineering">

    </head>

    <body class="bg-transparent pt-4">

        <div class="container">

                <a href="https://aveuiller.github.io" class="avatar-container float-left mx-4">
                    <div class="avatar ">
                        <div class="side"><img src="/images/profile.jpg" class="img-fluid"></div>
                    </div>
                </a>

            <h1>
                <a href="https://aveuiller.github.io" class="text-dark text-decoration-none">Antoine Veuiller</a>
                <small class="text-secondary"><small></small></small>
            </h1>

            <nav class="navbar d-block navbar-expand-lg navbar-light bg-light shadow rounded-lg">

                <a class="navbar-brand d-none" href="https://aveuiller.github.io" title="">Antoine Veuiller</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#plumage-navbar-collapse-1" aria-controls="plumage-navbar-collapse-1" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="plumage-navbar-collapse-1">

                    <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
<li class="nav-item ">
                                    <a class="nav-link" href="https://aveuiller.github.io/pages/about-me.html">
                                        About Me
                                    </a>
                                </li>
<li class="nav-item ">
                                    <a class="nav-link" href="https://aveuiller.github.io/pages/collaborations.html">
                                        Collaborations
                                    </a>
                                </li>
<li class="nav-item ">
                                    <a class="nav-link" href="https://aveuiller.github.io/category/around-computer-science.html">
                                        Around Computer Science
                                    </a>
                                </li>
<li class="nav-item ">
                                    <a class="nav-link" href="https://aveuiller.github.io/category/software-engineering.html">
                                        Software Engineering
<span class="sr-only">(current)</span>                                    </a>
                                </li>
                    </ul>


                </div>

            </nav>

        </div>


        <div class="container mt-5">


            <div class="row">
                <div class="
                        col-md-9
">
    <h1>
        <a href="https://aveuiller.github.io/troubleshooting_generic_approach.html" rel="bookmark" title="Permalink to A Generic Approach to Troubleshooting">A Generic Approach to Troubleshooting</a>
    </h1>
                </div>
            </div>

            <div class="row">


                <div id="content" role="main" class="
                        col-md-9
">
    

    <h3>Availability Disclaimer</h3>
<p>This article can be found on other sources:</p>
<ul>
<li>Hacker Noon: <a href="#TODO">TODO</a></li>
<li>Medium: <a href="https://aveuiller.medium.com/a-generic-approach-to-troubleshooting-dda764fbbb6">link</a></li>
<li>Dev.to: <a href="https://dev.to/aveuiller/a-generic-approach-to-troubleshooting-14jp">link</a></li>
</ul>
<hr>
<p>When working with a production system, you may encounter errors at any point, originating either from an application or its underlying host.
While it may become natural for a seasoned engineer to pinpoint its origin, it can be overwhelming at times if you are unsure of where to look.</p>
<p>This article aims to provide a generic framework to tackle production issues.
The framework will serve as a basis for any engineer aiming to learn about troubleshooting basics.
However, as with any generic framework, it may need adjustments for specific use cases.</p>
<h2>Environment</h2>
<p>In this article, we consider that you are working on a project that already implements the <a href="https://www.pagerduty.com/resources/learn/best-practices-for-monitoring/">best practices in terms of monitoring</a>
so that you have access to sensible metrics, defined for instance through the <a href="https://brendangregg.com/usemethod.html">USE Method</a>.
Those metrics can be used to provide performance dashboards and declare alerts triggered in case of faulty or suspicious behavior.
For a more visual reference, the following diagram shows a basic monitoring architecture using <a href="https://prometheus.io/">Prometheus</a>, <a href="https://grafana.com/">Grafana</a>, and <a href="https://prometheus.io/docs/alerting/latest/alertmanager/">Alert Manager</a>.</p>
<p><img alt="Basic Monitoring Environment" src="/images/posts/2022-09-18_troubleshooting_basics/Monitoring_Environment.svg" class="img-fluid border rounded shadow image-process-article-photo"></p>
<p>Upon the reception of an alert for an issue impacting a production service, the actions to take can be broken down into three steps: <em>Analysis</em>, <em>Correction</em>, and <em>Post-Mortem</em>.
As some of the traces found or produced during the incident can be transient, it is recommended to keep track of any event and action that was taken on the production during the analysis and correction phases.
This will ease the post-mortem phase.</p>
<h2>Analysis</h2>
<h3>Explore The Issue</h3>
<p>The first step when receiving an alert will be to find any known information about it.
Usually, a <a href="https://www.pagerduty.com/resources/learn/what-is-a-runbook/"><em>Runbook</em></a> will explain the reason why this alert fired and the steps to take to solve it.</p>
<p>Even if the solution seems simple, you may want to find the scope of the problem.
Your response might differ if the issue is impacting one or hundreds of hosts.
Likewise, an issue crippling production will require a low response time to issue corrective action,
while a less critical issue, like a decrease in performance, may give you more time for analysis.</p>
<p>While your production servers should behave in the same way, 
in some cases you will need to investigate the error before being able to determine the actual number of impacted hosts.</p>
<h3>Check The Basic Metrics</h3>
<p>If you have multiple hosts impacted, take one of them as an analysis host before you have a clear view of which metrics are important in the current case.
If you have the chance to have metrics exported to a dashboard, for instance through <a href="https://github.com/prometheus/node_exporter">node-exporter</a>,
you will be able to see the issue quite easily from the different indicators.
Otherwise, you will need to jump on the host and use the <a href="https://linuxconfig.org/linux-basic-health-check-commands">usual tools</a> to get more insights into the host's health.
In any case, you will be looking for issues with the CPU, RAM, Load, Disk, and Network.</p>
<p>This first step will indicate if the issue is purely applicative, or if your server is over-used to some extent.
This will also help you reduce the scope of where to look further down the investigation.</p>
<p>Regardless of the result of the previous check, you will need to look at the application-specific metrics,
both for performance through CPU and RAM usage, as well as applicative metrics such as response time, workload queues, and more.
You also need to check the applicative logs looking for anything that stands out of the ordinary.</p>
<p>From there, if you have enough information to at least recognize the issue and perform a temporary corrective action,
you should go for it and fix the production as soon as possible before digging Further.</p>
<h3>Dive Deeper into The Application Metrics</h3>
<p>If you didn't find the root cause of the error yet, you need to dig into the application behavior and its interaction with the system.
This step is mostly dependent on the application, but there are some common checks that could show irregularities.</p>
<p>On the system side, you can take a look at:</p>
<ul>
<li>The network communications and connectivity (e.g.
  <a href="https://man7.org/linux/man-pages/man1/tcpdump.1.html">tcpdump</a>,
  <a href="https://man7.org/linux/man-pages/man8/netstat.8.html">netstat</a>,
  <a href="https://www.commandlinux.com/man-page/man1/telnet.1.html">telnet</a>,
  <a href="https://www.commandlinux.com/man-page/man8/mtr.8.html">mtr</a>).</li>
<li>The Kernel and related logs (e.g. 
  <a href="https://man7.org/linux/man-pages/man1/journalctl.1.html">journalctl</a>,
  <a href="https://man7.org/linux/man-pages/man1/dmesg.1.html">dmesg</a>, …)</li>
</ul>
<p>On the applicative side, you can take a look at:</p>
<ul>
<li>The configuration through files and environment variables (e.g. <a href="https://man7.org/linux/man-pages/man5/proc.5.html">/proc</a>).</li>
<li>The opened file handles and connections (e.g. <a href="https://man7.org/linux/man-pages/man8/lsof.8.html">lsof</a>).</li>
<li>The system calls that are performed by the application (e.g. <a href="https://man7.org/linux/man-pages/man1/strace.1.html">strace</a>).</li>
<li>The application performances in a specific code path (e.g. <a href="https://man7.org/linux/man-pages/man1/gdb.1.html">gdb</a>, <a href="https://github.com/google/pprof">pprof</a>, …).</li>
</ul>
<h2>Correction</h2>
<h3>Protect The Production</h3>
<p>It is important to protect production from the issue as soon as possible.
This can take many forms but usually, you will either implement a quick fix,
that will enable the instance to still run until a long-term solution is implemented,
or isolate the faulty application from the production pools.
The latter can be done for instance by redirecting the load-balancer flow to other instances.</p>
<p>With orchestration solutions and stateless services,
it could be appealing to simply restart the application and use a brand-new instance.
This may work in some cases, but be sure to backup all data required for further investigation before doing so,
otherwise, you may end up in the same situation later.</p>
<h3>Implement a Long-Term Solution</h3>
<p>Once the production is secured, you can catch your breath and start digging further into the data you collected to find the actual root cause of the alert that was triggered.
Even if the situation is stable for now, you may want to improve the overall code quality so the <em>future you</em> don't have to investigate this issue again.</p>
<p>This section is entirely specific to the encountered issue, the actual fix could range from host configuration or code update to a complete architectural refactor in some cases.
I would advise performing the long-term fix as soon as possible, but you may be compelled to write down the Post-Mortem beforehand if the fix is big or impacts multiple components.</p>
<h2>Post-Mortem</h2>
<h3>Write The Actual Post-Mortem</h3>
<p>The main point of a <a href="https://sre.google/sre-book/postmortem-culture/">Post-Mortem</a> is to hold all relevant events and actions that took place during the incident.
This helps to understand the issue and improve the response process for future incidents.
It also helps fellow engineers to map potential side effects they experienced to the main incident.</p>
<p>On top of the precise timeline, you need to describe the actual root cause from which the incident originates and the action you and your team are proposing to avoid this issue from recurring.
In case of a corrective action impacting multiple components, you will need to have this post-mortem reviewed by the right stakeholders before taking action.
The post-mortem should hold enough information for a peer to have a strong opinion about the proposal.</p>
<h3>Improve Runbooks And Alerts</h3>
<p>Depending on the corrective action you took, you may need to create new alerts to cover different edge cases and modify the runbook sections with up-to-date data.</p>
<p>Even if the changes you performed are trivial, use this step as a feedback loop on the data you were missing during the investigation to help the <em>future you</em> during the next investigation.</p>
<h2>Conclusion</h2>
<p>This article aims to provide a baseline of investigation in case of a generic production incident.
The procedure will not show you the error if you don't ask the right questions but defines a framework to help you find the right questions to ask, and where to write the answers.</p>
<p>As a picture is worth a thousand words, here is a summary of the article through a simple flow chart.</p>
<p><img alt="Troubleshooting Operations Flowchart" src="/images/posts/2022-09-18_troubleshooting_basics/Generic_Troubleshooting_Guide.svg" class="img-fluid border rounded shadow image-process-article-photo"></p>
<p><em>Thanks to Sarra Habchi for the review</em></p>



                </div>

                    <div class="col-md-3">
    <div class="card bg-light text-dark">
        <ul class="list-group list-group-flush">

            <li class="list-group-item">
                <abbr title="2022-09-18T00:00:00+02:00"><i class="fas fa-calendar"></i> dim. 18 septembre 2022</abbr>
            </li>

                <li class="list-group-item">
                    <address>
                        <i class="fas fa-user"></i> By
                            <a href="https://aveuiller.github.io/author/antoine-veuiller.html" rel="author">Antoine Veuiller</a>
                    </address>
                </li>

                <li class="list-group-item">
                                <a href="https://aveuiller.github.io/category/software-engineering.html" rel="tag" data-toggle="tooltip" class="badge badge-info" title="6 articles in this category">Software Engineering</a>
                            <a href="/tag/best-practice.html" data-toggle="tooltip" class="badge badge-secondary" title="3 articles with this tag">Best Practice</a>
                            <a href="/tag/system-engineering.html" data-toggle="tooltip" class="badge badge-secondary" title="1 article with this tag">System Engineering</a>
                </li>



        </ul>
    </div>
                        
                    </div>

            </div>

        </div>

        <footer class="container-fluid mt-5 p-4 small">
            <div class="row mx-5">

                    <div class="col-md-2">
                            <h6>Social</h6>
                            <ul class="list-unstyled">
                                        <li><a href="http://twitter.com/AVeuiller">
        <i class="fab fa-twitter fa-fw"></i>
    Twitter
</a></li>
                                        <li><a href="https://stackoverflow.com/users/2564085/aveuiller">
        <i class="fab fa-stack-overflow fa-fw"></i>
    StackOverflow
</a></li>
                                        <li><a href="http://github.com/aveuiller">
        <i class="fab fa-github fa-fw"></i>
    GitHub
</a></li>
                                        <li><a href="https://aveuiller.medium.com/">
        <img src="https://www.google.com/s2/favicons?domain=aveuiller.medium.com" width="16" height="16" class="link-icon" alt="aveuiller.medium.com icon">
    Medium
</a></li>
                                        <li><a href="https://dev.to/aveuiller/">
        <img src="https://www.google.com/s2/favicons?domain=dev.to" width="16" height="16" class="link-icon" alt="dev.to icon">
    Dev.to
</a></li>
                            </ul>
                    </div>
                    <div class="col-md-2">
                    </div>

                <div class="col-md-2">
                    <h6>Browse content by</h6>
                    <ul class="list-unstyled">
                    </ul>
                </div>

                <div class="col-md-2 text-muted">
                    <h6>Copyright notice</h6>
                    <p class="small">
                        © Copyright
                        2020-2022
                        Antoine Veuiller.
                    </p>
                </div>

                <div class="col-md-2 text-muted">
                    <h6>Disclaimer</h6>
                    <p class="small">
                            All opinions expressed in this site are my own
                            personal opinions and are not endorsed by, nor
                            do they represent the opinions of my previous,
                            current and future employers or any of its
                            affiliates, partners or customers.
                    </p>
                </div>

                <div class="col-md-2">
                        <h6>Feeds</h6>
                        <ul class="list-unstyled small">
                                <li>
                                    <a href="https://aveuiller.github.io/feeds/all.atom.xml">
                                        <i class="fas fa-atom fa-fw"></i> All posts (Atom)
                                    </a>
                                </li>
                                <li>
                                    <a href="https://aveuiller.github.io/feeds/software-engineering.atom.xml">
                                        <i class="fas fa-atom fa-fw"></i> Category: Software Engineering (Atom)
                                    </a>
                                </li>
                        </ul>
                </div>

            </div>
            <div class="row mt-3">

                <div class="offset-3 col-6 small text-muted text-center">
                    Site generated by <a class="text-dark" href="https://getpelican.com">Pelican</a>.<br>
                    <a class="text-dark" href="https://github.com/kdeldycke/plumage">Plumage</a>
                    theme by <a class="text-dark" href="https://kevin.deldycke.com">Kevin Deldycke</a>.
                </div>

                <div class="col-3 text-right d-flex flex-column">
                    <a class="mt-auto" href="#"><i class="fas fa-arrow-up"></i> Back to top</a>
                </div>

            </div>
        </footer>

    </body>
</html>